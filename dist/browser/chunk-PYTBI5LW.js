import{a as W}from"./chunk-IY6NNTK7.js";import{a as k,b as G,c as _,d as P,e as O,h as D,i as M,k as H,l as R,m as $,n as j,o as B,p as L,q,r as Y,s as z,u as J,v as K,w as Q}from"./chunk-PSDSZU3V.js";import{Ab as b,Bb as p,Eb as E,Fc as I,Kb as n,Lb as U,M as A,Mb as w,Ta as l,Za as x,ba as S,ca as h,db as F,h as y,hb as u,n as N,ob as a,tb as t,ub as e,vb as m,vc as T,wc as V,zb as g}from"./chunk-TZJJSUIX.js";import"./chunk-EQDQRRRY.js";function te(o,i){if(o&1){let r=g();t(0,"button",10),b("click",function(){S(r);let d=p();return h(d.uploadCsv())}),n(1," Upload CSV Users "),e()}}function re(o,i){if(o&1&&(t(0,"th"),n(1),e()),o&2){let r=i.$implicit;l(),U(r)}}function ie(o,i){if(o&1&&(t(0,"td"),n(1),e()),o&2){let r=i.$implicit,s=p().$implicit;l(),U(s[r])}}function ne(o,i){if(o&1&&(t(0,"tr"),u(1,ie,2,1,"td",13),e()),o&2){let r=p(2);l(),a("ngForOf",r.csvHeaders)}}function oe(o,i){if(o&1&&(t(0,"div",0)(1,"h5"),n(2,"Preview CSV Data"),e(),t(3,"div",11)(4,"table",12)(5,"thead")(6,"tr"),u(7,re,2,1,"th",13),e()(),t(8,"tbody"),u(9,ne,2,1,"tr",13),e()()()()),o&2){let r=p();l(7),a("ngForOf",r.csvHeaders),l(2),a("ngForOf",r.csvUsers)}}function se(o,i){if(o&1){let r=g();t(0,"button",40),b("click",function(){S(r);let d=p().index,c=p();return h(c.removeUser(d))}),n(1," Remove User "),e()}}function le(o,i){if(o&1&&(t(0,"div",14)(1,"div",15)(2,"h5",16),n(3),e()(),t(4,"div",17)(5,"div",18)(6,"div",19)(7,"label"),n(8,"Name"),e(),m(9,"input",20),e(),t(10,"div",19)(11,"label"),n(12,"Email"),e(),m(13,"input",21),e()(),t(14,"div",18)(15,"div",19)(16,"label"),n(17,"Password"),e(),m(18,"input",22),e(),t(19,"div",19)(20,"label"),n(21,"Phone Number"),e(),m(22,"input",23),e()(),t(23,"div",18)(24,"div",24)(25,"label"),n(26,"Referral Code"),e(),m(27,"input",25),e(),t(28,"div",24)(29,"label"),n(30,"Promo Code"),e(),m(31,"input",26),e(),t(32,"div",24)(33,"label"),n(34,"Bonus Points"),e(),m(35,"input",27),e()(),t(36,"div",18)(37,"div",24)(38,"label"),n(39,"Device Info"),e(),m(40,"input",28),e(),t(41,"div",24)(42,"label"),n(43,"Location"),e(),m(44,"input",29),e(),t(45,"div",24)(46,"label"),n(47,"User Type"),e(),t(48,"select",30)(49,"option",31),n(50,"User"),e(),t(51,"option",32),n(52,"Admin"),e()()()(),t(53,"div",33),m(54,"input",34),t(55,"label",35),n(56,"Active"),e()(),t(57,"div",18)(58,"div",19)(59,"label"),n(60,"Review Score"),e(),m(61,"input",36),e(),t(62,"div",19)(63,"label"),n(64,"Review Context"),e(),m(65,"input",37),e()(),t(66,"div",38),u(67,se,2,0,"button",39),e()()()),o&2){let r=i.index,s=p();a("formGroupName",r),l(3),w("User ",r+1,""),l(51),E("id","active",r,""),l(),E("for","active",r,""),l(12),a("ngIf",s.users.length>1)}}var X=class o{constructor(i,r){this.fb=i;this.usersSvc=r;this.usersForm=this.fb.group({users:this.fb.array([this.createUserGroup()])})}usersForm;csvHeaders=[];csvUsers=[];isCsvPreviewVisible=!1;get users(){return this.usersForm.get("users")}createUserGroup(){return this.fb.group({name:["",_.required],email:["",[_.required,_.email]],password:[""],phoneNumber:[""],referralCode:[""],promoCode:[""],bonusPoints:[0],deviceInfo:[""],location:[""],userType:["user"],isActive:[!0],reviewScore:[0],reviewContext:[""]})}addUser(){this.users.push(this.createUserGroup())}removeUser(i){this.users.removeAt(i)}onSubmit(){if(this.usersForm.invalid)return;let i=this.usersForm.value.users;this.usersSvc.bulkAddUsers(i).subscribe({next:()=>alert("Users added successfully"),error:r=>alert(`Error: ${r.message||r.status}`)})}onCsvFileChange(i){let r=i.target;if(!r.files?.length)return;let s=new FileReader;s.onload=()=>{let d=s.result.split(/\r?\n/).filter(c=>c.trim());this.csvHeaders=d.shift().split(",").map(c=>c.trim()),this.csvUsers=d.map(c=>{let Z=c.split(",").map(f=>f.trim()),C={};return this.csvHeaders.forEach((f,ee)=>{let v=Z[ee]??"";f==="bonusPoints"||f==="reviewScore"?v=Number(v)||0:f==="isActive"&&(v=v.toLowerCase()==="true"||v==="1"),C[f]=v}),C.userType=C.userType||"user",C}),this.isCsvPreviewVisible=!0},s.readAsText(r.files[0])}uploadCsv(){this.csvUsers.length&&this.usersSvc.getUsers().pipe(N(i=>{let r=new Set(i.map(s=>s.email));return this.csvUsers.filter(s=>!r.has(s.email))}),A(i=>i.length?this.usersSvc.bulkAddUsers(i):(alert("No new users to add"),y))).subscribe({next:()=>{alert("CSV users uploaded successfully"),this.csvUsers=[],this.csvHeaders=[],this.isCsvPreviewVisible=!1,this.users.clear(),this.users.push(this.createUserGroup())},error:i=>{console.error("CSV upload error:",i),alert(`CSV upload error: ${i.status} \u2013 ${i.error?.message||i.message}`)}})}static \u0275fac=function(r){return new(r||o)(x(J),x(W))};static \u0275cmp=F({type:o,selectors:[["app-add-users"]],decls:14,vars:4,consts:[[1,"mb-4"],["type","file","accept",".csv",1,"form-control",3,"change"],["class","btn btn-success mt-2",3,"click",4,"ngIf"],["class","mb-4",4,"ngIf"],[3,"ngSubmit","formGroup"],["formArrayName","users"],["class","card mb-3 shadow-sm",3,"formGroupName",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","mt-3"],["type","button",1,"btn","btn-primary",3,"click"],["type","submit",1,"btn","btn-success"],[1,"btn","btn-success","mt-2",3,"click"],[1,"table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"card","mb-3","shadow-sm",3,"formGroupName"],[1,"card-header"],[1,"mb-0"],[1,"card-body"],[1,"row","mb-2"],[1,"col-md-6"],["type","text","formControlName","name",1,"form-control"],["type","email","formControlName","email",1,"form-control"],["type","password","formControlName","password",1,"form-control"],["formControlName","phoneNumber",1,"form-control"],[1,"col-md-4"],["formControlName","referralCode",1,"form-control"],["formControlName","promoCode",1,"form-control"],["type","number","formControlName","bonusPoints",1,"form-control"],["formControlName","deviceInfo",1,"form-control"],["formControlName","location",1,"form-control"],["formControlName","userType",1,"form-select"],["value","user"],["value","admin"],[1,"form-check","mb-2"],["type","checkbox","formControlName","isActive",1,"form-check-input",3,"id"],[1,"form-check-label",3,"for"],["type","number","min","0","max","5","formControlName","reviewScore",1,"form-control"],["formControlName","reviewContext",1,"form-control"],[1,"text-end"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(r,s){r&1&&(t(0,"div",0)(1,"h4"),n(2,"Import Users via CSV"),e(),t(3,"input",1),b("change",function(c){return s.onCsvFileChange(c)}),e(),u(4,te,2,0,"button",2),e(),u(5,oe,10,2,"div",3),t(6,"form",4),b("ngSubmit",function(){return s.onSubmit()}),t(7,"div",5),u(8,le,68,7,"div",6),e(),t(9,"div",7)(10,"button",8),b("click",function(){return s.addUser()}),n(11," + Add Another User "),e(),t(12,"button",9),n(13," Submit Users "),e()()()),r&2&&(l(4),a("ngIf",s.isCsvPreviewVisible),l(),a("ngIf",s.isCsvPreviewVisible),l(),a("formGroup",s.usersForm),l(2),a("ngForOf",s.users.controls))},dependencies:[I,T,V,K,D,L,q,G,M,k,B,P,O,z,Y,Q,H,j,R,$],encapsulation:2})};export{X as AddUsersComponent};
