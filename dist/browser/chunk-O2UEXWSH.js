import{a as f}from"./chunk-D2BC6RJP.js";import{a as d}from"./chunk-KOQOYHGF.js";import{Mc as p,R as n,Rc as l,W as a,j as c,k as u,y as i}from"./chunk-HPFW3AUF.js";var m=(t=>(t.VIEW="VIEW",t.EDIT="EDIT",t))(m||{});var v=class o{constructor(r){this.http=r}apiUrl=`${l.apiUrl}/api/users`;handleError(r){let t="An error occurred";if(r.error instanceof ErrorEvent)t=r.error.message;else try{t=(typeof r.error=="string"?r.error.startsWith("{")?JSON.parse(r.error):{message:r.error}:r.error).message||r.message||"Unknown error occurred"}catch{t=typeof r.error=="string"?r.error:`Server error (${r.status}): ${r.message}`}return console.error("API Error:",{status:r.status,statusText:r.statusText,message:t,error:r.error}),u(()=>new Error(t))}searchProducts(r,t){return this.http.get(`${this.apiUrl}/${r}/products/search`,{params:{query:t}}).pipe(i(this.handleError))}getFavoriteProducts(r){return this.http.get(`${this.apiUrl}/${r}/favorite-products`).pipe(i(this.handleError))}addFavoriteProduct(r,t){return this.http.post(`${this.apiUrl}/${r}/favorite-products/${t}`,{}).pipe(i(this.handleError))}removeFavoriteProduct(r,t){return this.http.delete(`${this.apiUrl}/${r}/favorite-products/${t}`).pipe(i(this.handleError))}static \u0275fac=function(t){return new(t||o)(a(p))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};var h=class o{constructor(r,t){this.userProfileService=r;this.authService=t}awardPointsForListCreation(r=1){return this.awardPoints("create_list",r)}awardPointsForFavoriteProduct(r=1){return this.awardPoints("add_favorite_product",r)}awardPointsForFavoriteStore(r=1){return this.awardPoints("add_favorite_store",r)}awardPoints(r,t=1){let e=this.getCurrentUserId();return e?this.userProfileService.awardLoyaltyPoints(e,r,t).pipe(i(s=>(console.error(`Error awarding points for ${r}:`,s),c("Points could not be awarded")))):(console.warn("No current user found for points awarding"),c("No user logged in"))}showPointsNotification(r,t=!1){r.includes("Earned")||r.includes("Lucky")?(console.log("\u{1F389} "+r),t&&alert("\u{1F389} "+r)):console.log(r)}awardPointsWithNotification(r,t=1,e=!1){this.awardPoints(r,t).subscribe({next:s=>{this.showPointsNotification(s,e)},error:s=>{console.error("Failed to award points:",s)}})}getCurrentUserId(){try{let r=this.authService.getToken();if(r){let e=JSON.parse(atob(r.split(".")[1]));return e.id||e.userId||e.sub||null}let t=localStorage.getItem("userInfo");return t&&JSON.parse(t).id||null}catch(r){return console.error("Error extracting user ID:",r),null}}static \u0275fac=function(t){return new(t||o)(a(f),a(d))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a,v as b,h as c};
