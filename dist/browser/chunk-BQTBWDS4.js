import{a as f}from"./chunk-KPVCULSL.js";import{a as d}from"./chunk-MM22J7PI.js";import{Mc as c,R as n,Rc as p,W as s,j as u,k as l,y as i}from"./chunk-VE4VNBXX.js";var g=(t=>(t.VIEW="VIEW",t.EDIT="EDIT",t))(g||{});var m=class e{constructor(r){this.http=r}apiUrl=`${p.apiUrl}/api/users`;handleError(r){let t="An error occurred";if(r.error instanceof ErrorEvent)t=r.error.message;else try{t=(typeof r.error=="string"?r.error.startsWith("{")?JSON.parse(r.error):{message:r.error}:r.error).message||r.message||"Unknown error occurred"}catch{t=typeof r.error=="string"?r.error:`Server error (${r.status}): ${r.message}`}return console.error("API Error:",{status:r.status,statusText:r.statusText,message:t,error:r.error}),l(()=>new Error(t))}searchProducts(r,t){return this.http.get(`${this.apiUrl}/${r}/products/search`,{params:{query:t}}).pipe(i(this.handleError))}getFavoriteProducts(r){return this.http.get(`${this.apiUrl}/${r}/favorite-products`).pipe(i(this.handleError))}addFavoriteProduct(r,t){return this.http.post(`${this.apiUrl}/${r}/favorite-products/${t}`,{}).pipe(i(this.handleError))}removeFavoriteProduct(r,t){return this.http.delete(`${this.apiUrl}/${r}/favorite-products/${t}`).pipe(i(this.handleError))}static \u0275fac=function(t){return new(t||e)(s(c))};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})};var h=class e{constructor(r,t){this.userProfileService=r;this.authService=t}awardPointsForListCreation(r=1){return this.awardPoints("create_list",r)}awardPointsForFavoriteProduct(r=1){return this.awardPoints("add_favorite_product",r)}awardPointsForFavoriteStore(r=1){return this.awardPoints("add_favorite_store",r)}awardPoints(r,t=1){let o=this.getCurrentUserId();return o?this.userProfileService.awardLoyaltyPoints(o,r,t).pipe(i(a=>(console.error(`Error awarding points for ${r}:`,a),u("Points could not be awarded")))):(console.warn("No current user found for points awarding"),u("No user logged in"))}showPointsNotification(r,t=!1){r.includes("Earned")||r.includes("Lucky")?(console.log("\u{1F389} "+r),t&&alert("\u{1F389} "+r)):console.log(r)}awardPointsWithNotification(r,t=1,o=!1){this.awardPoints(r,t).subscribe({next:a=>{this.showPointsNotification(a,o)},error:a=>{console.error("Failed to award points:",a)}})}getCurrentUserId(){try{let r=this.authService.getToken();if(r){let o=JSON.parse(atob(r.split(".")[1]));return o.id||o.userId||o.sub||null}let t=localStorage.getItem("userInfo");return t&&JSON.parse(t).id||null}catch(r){return console.error("Error extracting user ID:",r),null}}static \u0275fac=function(t){return new(t||e)(s(f),s(d))};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})};var b=class e{constructor(r){this.http=r}apiUrl=`${p.apiUrl}/api/users`;getAllItems(r){return this.http.get(`${this.apiUrl}/${r}/products`)}getItemPrices(r,t){return this.http.get(`${this.apiUrl}/${r}/products/${t}/prices`)}static \u0275fac=function(t){return new(t||e)(s(c))};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})};export{g as a,m as b,h as c,b as d};
