import{a as L}from"./chunk-LSUSMVOF.js";import"./chunk-4RDB7OU6.js";import{e as k,g as V}from"./chunk-OGJVD6VD.js";import{b as T,d as W,e as R,f as B,g as N,h as z,t as A,v as D}from"./chunk-PSDSZU3V.js";import{Ab as f,Bb as d,Fc as O,Gb as I,Hb as E,Hc as F,Ib as S,Kb as c,Mb as M,Oa as y,Qb as _,Rb as x,Sb as C,Ta as l,Za as b,ba as m,ca as g,db as P,hb as h,ob as p,tb as r,ub as a,va as w,vb as u,wc as U,zb as v}from"./chunk-TZJJSUIX.js";import"./chunk-EQDQRRRY.js";var q=["fileInput"];function Q(s,i){if(s&1){let e=v();r(0,"div",9)(1,"p"),c(2),a(),r(3,"button",10),f("click",function(){m(e);let t=d(2);return g(t.clearSelectedFile())}),c(4,"Clear"),a()()}if(s&2){let e=d(2);l(2),M("Selected: ",e.selectedFile.name,""),l(),p("disabled",e.isUploading)}}function H(s,i){s&1&&(r(0,"div",11)(1,"p"),c(2,"Uploading image..."),a()())}function G(s,i){if(s&1){let e=v();r(0,"div",3)(1,"img",4),f("error",function(t){m(e);let o=d();return g(o.setDefaultImage(t))}),a(),u(2,"br"),r(3,"button",5),f("click",function(){m(e);let t=d();return g(t.triggerFileInput())}),c(4),a(),r(5,"input",6,0),f("change",function(t){m(e);let o=d();return g(o.onFileSelected(t))}),a(),h(7,Q,5,2,"div",7)(8,H,3,0,"div",8),a()}if(s&2){let e=d();l(),p("src",e.previewImageUrl||e.getFullImageUrl(e.user.avatar)||"assets/images/avatar.png",y),l(2),p("disabled",e.isUploading),l(),M(" ",e.isUploading?"Uploading...":"Change Profile Picture"," "),l(),p("disabled",e.isUploading),l(2),p("ngIf",e.selectedFile),l(),p("ngIf",e.isUploading)}}function J(s,i){if(s&1){let e=v();r(0,"form",12),f("ngSubmit",function(){m(e);let t=d();return g(t.onSubmit())}),r(1,"label"),c(2," Name: "),r(3,"input",13),C("ngModelChange",function(t){m(e);let o=d();return x(o.user.name,t)||(o.user.name=t),g(t)}),a()(),u(4,"br"),r(5,"label"),c(6," Email: "),r(7,"input",14),C("ngModelChange",function(t){m(e);let o=d();return x(o.user.email,t)||(o.user.email=t),g(t)}),a()(),u(8,"br"),r(9,"label"),c(10," Phone: "),r(11,"input",15),C("ngModelChange",function(t){m(e);let o=d();return x(o.user.phone,t)||(o.user.phone=t),g(t)}),a()(),u(12,"br"),r(13,"label"),c(14," Address: "),r(15,"input",16),C("ngModelChange",function(t){m(e);let o=d();return x(o.user.address,t)||(o.user.address=t),g(t)}),a()(),u(16,"br"),r(17,"fieldset",17)(18,"label"),c(19," Referral/Coupon Code: "),u(20,"input",18),a(),u(21,"br"),r(22,"label"),c(23," Loyalty Points: "),u(24,"input",19),a(),u(25,"br"),r(26,"label"),c(27," Credits Available: "),u(28,"input",19),a(),u(29,"br"),a(),r(30,"button",20),c(31,"Save Changes"),a()()}if(s&2){let e=d();l(3),_("ngModel",e.user.name),l(4),_("ngModel",e.user.email),l(4),_("ngModel",e.user.phone),l(4),_("ngModel",e.user.address),l(5),p("value",e.user.couponCode||"N/A"),l(4),p("value",e.user.bonus_points||e.user.loyaltyPoints||0),l(4),p("value",e.user.creditsAvailable||0)}}var j=class s{constructor(i,e,n,t){this.platformId=i;this.route=e;this.userProfileService=n;this.router=t}fileInput;user;selectedFile=null;previewImageUrl=null;isUploading=!1;ngOnInit(){if(F(this.platformId)){let i=this.route.snapshot.paramMap.get("id");i&&i!=="null"?this.userProfileService.getUserProfileById(i).subscribe({next:e=>{this.user=e},error:e=>{console.error("Error fetching user profile:",e),alert("Invalid user ID or profile not found"),this.router.navigate(["/"])}}):(alert("Invalid user ID"),this.router.navigate(["/"]))}}onFileSelected(i){let e=i.target;if(e.files&&e.files[0]){let n=e.files[0];if(!n.type.startsWith("image/")){alert("Please select a valid image file.");return}if(n.size>5*1024*1024){alert("File size must be less than 5MB.");return}this.selectedFile=n;let t=new FileReader;t.onload=o=>{this.previewImageUrl=o.target?.result},t.readAsDataURL(n)}}triggerFileInput(){this.fileInput.nativeElement.click()}clearSelectedFile(){this.selectedFile=null,this.previewImageUrl=null,this.fileInput&&(this.fileInput.nativeElement.value="")}getFullImageUrl(i){return i?i.startsWith("http")||i.startsWith("data:")?i:i.startsWith("/uploads/")?`http://localhost:8080${i}`:i:null}onSubmit(){this.user?.id?this.selectedFile?(this.isUploading=!0,this.userProfileService.uploadProfilePicture(this.user.id,this.selectedFile).subscribe({next:i=>{this.user.avatar=i,this.isUploading=!1,this.clearSelectedFile(),this.updateUserProfile()},error:i=>{console.error("File upload failed:",i),this.isUploading=!1,alert("Failed to upload profile picture. Please try again.")}})):this.updateUserProfile():alert("No user data available to update")}updateUserProfile(){this.userProfileService.updateUserProfile(this.user.id,this.user).subscribe({next:()=>{alert("Profile updated successfully!"),this.router.navigate(["/user-profile",this.user.id])},error:i=>{console.error("Error updating user profile:",i),alert("Failed to update profile. Please try again.")}})}setDefaultImage(i){let e=i.target;e.src="assets/images/avatar.png"}static \u0275fac=function(e){return new(e||s)(b(w),b(k),b(L),b(V))};static \u0275cmp=P({type:s,selectors:[["app-user-edit"]],viewQuery:function(e,n){if(e&1&&I(q,5),e&2){let t;E(t=S())&&(n.fileInput=t.first)}},decls:2,vars:2,consts:[["fileInput",""],["class","profile-image-wrapper",4,"ngIf"],[3,"ngSubmit",4,"ngIf"],[1,"profile-image-wrapper"],["alt","Profile Picture","width","150","height","150",1,"profile-preview",3,"error","src"],["type","button",1,"change-picture-btn",3,"click","disabled"],["type","file","accept","image/*",2,"display","none",3,"change","disabled"],["class","file-info",4,"ngIf"],["class","upload-progress",4,"ngIf"],[1,"file-info"],["type","button",1,"clear-btn",3,"click","disabled"],[1,"upload-progress"],[3,"ngSubmit"],["type","text","name","name","required","",3,"ngModelChange","ngModel"],["type","email","name","email","required","",3,"ngModelChange","ngModel"],["type","text","name","phone",3,"ngModelChange","ngModel"],["type","text","name","address",3,"ngModelChange","ngModel"],["disabled",""],["type","text",3,"value"],["type","number",3,"value"],["type","submit"]],template:function(e,n){e&1&&h(0,G,9,6,"div",1)(1,J,32,7,"form",2),e&2&&(p("ngIf",n.user),l(),p("ngIf",n.user))},dependencies:[O,U,D,z,T,W,R,A,N,B],styles:["form[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;padding:1.5rem;background-color:#f9f9f9;border-radius:8px;box-shadow:0 2px 8px #0000001a}.profile-image-wrapper[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem;padding:1rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}.profile-image-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;object-fit:cover;border:2px solid #ddd}.profile-image-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:.5rem}form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:1rem;font-weight:500}form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.5rem;font-size:1rem;margin-top:.25rem;border:1px solid #0B3B5B;border-radius:4px}button[_ngcontent-%COMP%]{padding:.6rem 1.2rem;background-color:#0b3b5b;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem;margin-top:.5rem}button[disabled][_ngcontent-%COMP%]{background-color:#ccc;cursor:not-allowed}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem;padding:.6rem 1.2rem;background-color:#0b3b5b;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem}form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{background-color:#ccc;cursor:not-allowed}img[_ngcontent-%COMP%]{display:block;margin:1rem auto;border-radius:50%;object-fit:cover;border:2px solid #ddd}.profile-preview[_ngcontent-%COMP%]{border-radius:50%;object-fit:cover;border:3px solid #0B3B5B;transition:all .3s ease;box-shadow:0 2px 8px #007bff33}.profile-preview[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #007bff4d}.change-picture-btn[_ngcontent-%COMP%]{background-color:#0b3b5bcc;color:#fff;border:none;padding:.5rem 1rem;border-radius:6px;cursor:pointer;font-size:.9rem;margin-top:.5rem;transition:background-color .3s ease}.change-picture-btn[_ngcontent-%COMP%]:hover{background-color:#0b3b5b}.file-info[_ngcontent-%COMP%]{margin-top:1rem;padding:.5rem;background-color:#e7f3ff;border:1px solid #b3d7ff;border-radius:4px;font-size:.9rem}.file-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#333}.clear-btn[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:.3rem .6rem;border-radius:4px;cursor:pointer;font-size:.8rem;transition:background-color .3s ease}.clear-btn[_ngcontent-%COMP%]:hover{background-color:#c82333}.upload-progress[_ngcontent-%COMP%]{margin-top:1rem;padding:.5rem;background-color:#fff3cd;border:1px solid #ffeaa7;border-radius:4px;font-size:.9rem;color:#856404;text-align:center}.upload-progress[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}button[_ngcontent-%COMP%]:disabled{background-color:#ccc!important;cursor:not-allowed!important;opacity:.6}button[_ngcontent-%COMP%]:disabled:hover{background-color:#ccc!important}"]})};export{j as UserEditComponent};
