import{g as c}from"./chunk-Y6UGLKWX.js";import{Hc as g,Mc as u,O as a,R as p,Rc as s,W as o,va as l}from"./chunk-VE4VNBXX.js";var m=class i{constructor(t,e,r){this.http=t;this.router=e;this.platformId=r}apiUrl=s.apiUrl+"/auth";userApiUrl=s.apiUrl+"/user";storageKey="token";getStorage(){return g(this.platformId)?localStorage:null}login(t){let e={"Content-Type":"application/json",Accept:"application/json"};return this.http.post(`${this.apiUrl}/login`,t,{headers:e}).pipe(a(r=>{r.token&&(this.getStorage()?.setItem(this.storageKey,r.token),this.http.get(`${this.userApiUrl}/profile/me`).subscribe(n=>{this.getStorage()?.setItem("userInfo",JSON.stringify({id:n.id,email:n.email}))}))}))}register(t){return this.http.post(`${this.apiUrl}/register`,t,{responseType:"text"})}logout(){this.getStorage()?.removeItem(this.storageKey),this.router.navigate(["/login"])}getToken(){let t=this.getStorage();return t?t.getItem(this.storageKey):null}isLoggedIn(){return!!this.getToken()}getCurrentUserId(){let t=this.getStorage();if(!t)return null;let e=t.getItem("userInfo"),r=e?JSON.parse(e).id:null;if(!r)throw new Error("User ID not found. Please log in again.");return r}setCurrentUserId(t){let e=this.getStorage();e&&e.setItem("currentUserId",t)}clearCurrentUserId(){let t=this.getStorage();t&&t.removeItem("currentUserId")}getUserTypeFromToken(){let t=this.getToken();if(!t)return null;try{return JSON.parse(atob(t.split(".")[1])).userType}catch{return null}}isAdminUser(){return this.getUserTypeFromToken()==="ADMIN"}static \u0275fac=function(e){return new(e||i)(o(u),o(c),o(l))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};
