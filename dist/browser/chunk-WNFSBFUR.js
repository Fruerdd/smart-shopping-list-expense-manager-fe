import{b as je,c as Ue}from"./chunk-WC4H2OPB.js";import{q as T,r as L}from"./chunk-3RMZKVQ3.js";import{a as $e}from"./chunk-67XE7L3H.js";import{a as Ie}from"./chunk-N4J6XQ6T.js";import{c as H,e as Me,g as we}from"./chunk-NCA32NOU.js";import{b as W,c as Te,d as Q,e as Le,g as Ee,h as De,k as Ve,n as Fe,o as ke,p as Ne,q as Be,u as ze,v as G,w as J}from"./chunk-LNNPOXGM.js";import{$b as V,A as ce,Ab as f,Bb as l,D as le,E as U,Ec as P,Gb as ue,Hb as fe,Ib as he,Jb as D,Kb as d,Lb as _,M as N,Mb as M,Mc as Oe,Na as R,O as B,Oa as A,Qb as _e,R as de,Rb as xe,Sb as Ce,Ta as a,Vb as ve,W as pe,Za as I,aa as q,ba as m,ca as g,db as S,f as re,hb as u,j as ne,ka as C,n as se,ob as p,qb as E,t as ae,tb as n,ub as s,uc as w,vb as v,vc as b,wb as me,wc as Se,xb as ge,xc as be,yc as Pe,zb as h,zc as ye}from"./chunk-PWFS57B3.js";import{a as y,b as O}from"./chunk-EQDQRRRY.js";function Re(r,t){if(r&1&&(n(0,"mat-icon",9),d(1),s()),r&2){let e=l().$implicit;a(),_(e.icon)}}function Ae(r,t){if(r&1){let e=h();n(0,"div",4),f("click",function(){let o=m(e).$implicit,c=l();return g(c.toggleCategory(o))}),n(1,"div",5),u(2,Re,2,1,"mat-icon",6),n(3,"span",7),d(4),s()(),n(5,"span",8)(6,"mat-icon"),d(7),s()()()}if(r&2){let e=t.$implicit,i=l();E("selected",i.selectedCategoryId===e.id),a(2),p("ngIf",e.icon),a(2),_(e.name),a(3),_(i.selectedCategoryId===e.id?"expand_less":"expand_more")}}var K=class r{categories=[];categorySelected=new C;selectedCategoryId="default";toggleCategory(t){this.selectedCategoryId===t.id?(this.selectedCategoryId="default",this.categorySelected.emit(this.selectedCategoryId)):(this.selectedCategoryId=t.id,this.categorySelected.emit(t.id))}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=S({type:r,selectors:[["app-sidebar"]],inputs:{categories:"categories"},outputs:{categorySelected:"categorySelected"},decls:6,vars:1,consts:[[1,"sidebar"],[1,"sidebar-header"],[1,"category-list"],["class","category-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"category-item",3,"click"],[1,"category-content"],["fontSet","material-symbols-outlined",4,"ngIf"],[1,"category-name"],[1,"expand-icon"],["fontSet","material-symbols-outlined"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"h2"),d(3,"Sections"),s()(),n(4,"div",2),u(5,Ae,8,5,"div",3),s()()),e&2&&(a(5),p("ngForOf",i.categories))},dependencies:[P,w,b,T,L],styles:[".sidebar[_ngcontent-%COMP%]{width:240px;background-color:#fff;border-right:1px solid #e0e0e0;height:100%;overflow-y:auto;scroll-behavior:smooth;scrollbar-color:#0B3B5B white;box-shadow:0 2px 5px #0000001a}.sidebar-header[_ngcontent-%COMP%]{padding:16px 12px;border-bottom:1px solid #e0e0e0}.sidebar-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:#0b3b5b}.category-list[_ngcontent-%COMP%]{padding:8px 0}.category-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:220px;justify-content:space-between;padding:12px 16px;cursor:pointer;transition:background-color .2s}.category-item[_ngcontent-%COMP%]:hover{background-color:#fcacc480}.category-item.selected[_ngcontent-%COMP%]{background-color:#fcacc4;font-weight:700}.category-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.mat-icon[_ngcontent-%COMP%]{font-size:24px;color:#0b3b5b}.category-name[_ngcontent-%COMP%]{font-size:14px;color:#0b3b5b}.expand-icon[_ngcontent-%COMP%]{color:#0b3b5b}"]})};var Y=(F=>(F.PERSONAL="PERSONAL",F.WORK="WORK",F.SHOPPING="SHOPPING",F.GROCERY="GROCERY",F.PICKUP="PICKUP",F.DELIVERY="DELIVERY",F.OTHER="OTHER",F))(Y||{});function We(r,t){r&1&&(n(0,"div",16),d(1," Name is required "),s())}function Qe(r,t){if(r&1&&(n(0,"option",17),d(1),s()),r&2){let e=t.$implicit;p("value",e),a(),_(e)}}function Ge(r,t){if(r&1){let e=h();n(0,"div",18),f("click",function(){let o=m(e).$implicit,c=l();return g(c.toggleShareOption(o.userId))}),n(1,"span",19),d(2),s()()}if(r&2){let e=t.$implicit,i=l();E("selected",i.isShareOptionSelected(e.userId)),a(2),_(e.userName)}}var j=class r{constructor(t,e){this.formBuilder=t;this.userProfileService=e;let i=localStorage.getItem("userInfo");this.userId=i?JSON.parse(i).id:""}isEditMode=!1;initialValues={name:"",description:"",listType:"OTHER",shareWith:[]};formValuesChange=new C;listForm;listTypes=Object.values(Y);shareOptions=[];isLoading=!1;userId;ngOnInit(){this.initializeForm(),this.loadFriends(),this.isEditMode&&this.listForm.patchValue(this.initialValues)}ngOnChanges(t){t.initialValues&&!t.initialValues.firstChange&&this.listForm.patchValue(this.initialValues)}initializeForm(){this.listForm=this.formBuilder.group({name:[this.initialValues.name||"",Te.required],description:[this.initialValues.description||""],listType:[this.initialValues.listType||"OTHER"],shareWith:[this.initialValues.shareWith||[]]}),this.listForm.valueChanges.subscribe(t=>{this.formValuesChange.emit(t)})}loadFriends(){if(!this.userId){console.error("User ID not found");return}this.isLoading=!0,this.userProfileService.getUserFriends(this.userId).subscribe({next:t=>{if(this.shareOptions=t.map(e=>({userId:e.id,userName:e.name})),this.isEditMode&&this.initialValues.shareWith?.length>0){let e=new Set(this.shareOptions.map(o=>o.userId)),i=this.initialValues.shareWith.filter(o=>!e.has(o));i.length>0&&this.userProfileService.getUsersByIds(i).subscribe({next:o=>{let c=o.map(x=>({userId:x.id,userName:x.name}));this.shareOptions=[...this.shareOptions,...c]},error:o=>{console.error("Error loading additional collaborators:",o)}})}this.isLoading=!1},error:t=>{console.error("Error loading friends:",t),this.isLoading=!1}})}toggleShareOption(t){let e=this.listForm.get("shareWith")?.value||[],i=e.indexOf(t);i===-1?e.push(t):e.splice(i,1),this.listForm.patchValue({shareWith:e})}isShareOptionSelected(t){return(this.listForm.get("shareWith")?.value||[]).includes(t)}getFormValues(){return this.listForm.value}isFormValid(){return this.listForm.valid}reset(){this.listForm.reset(this.initialValues)}static \u0275fac=function(e){return new(e||r)(I(ze),I($e))};static \u0275cmp=S({type:r,selectors:[["app-list-form"]],inputs:{isEditMode:"isEditMode",initialValues:"initialValues"},outputs:{formValuesChange:"formValuesChange"},features:[q],decls:23,vars:4,consts:[[1,"form-container"],[3,"formGroup"],[1,"form-row"],[1,"form-group"],["for","listName"],["type","text","id","listName","formControlName","name","placeholder","List Name"],["class","error-message",4,"ngIf"],[1,"form-group","description-group"],["for","listDescription"],["id","listDescription","formControlName","description","placeholder","List Description"],["for","listType"],["id","listType","formControlName","listType"],[3,"value",4,"ngFor","ngForOf"],["for","shareWith"],["id","shareWith",1,"share-options-container"],["class","share-option",3,"selected","click",4,"ngFor","ngForOf"],[1,"error-message"],[3,"value"],[1,"share-option",3,"click"],[1,"share-name"]],template:function(e,i){if(e&1&&(n(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"label",4),d(5,"List Name"),s(),v(6,"input",5),u(7,We,2,0,"div",6),s(),n(8,"div",7)(9,"label",8),d(10,"List Description"),s(),v(11,"textarea",9),s()(),n(12,"div",2)(13,"div",3)(14,"label",10),d(15,"List Type"),s(),n(16,"select",11),u(17,Qe,2,2,"option",12),s()(),n(18,"div",3)(19,"label",13),d(20,"Share With"),s(),n(21,"div",14),u(22,Ge,3,3,"div",15),s()()()()()),e&2){let o;a(),p("formGroup",i.listForm),a(6),p("ngIf",((o=i.listForm.get("name"))==null?null:o.invalid)&&((o=i.listForm.get("name"))==null?null:o.touched)),a(10),p("ngForOf",i.listTypes),a(5),p("ngForOf",i.shareOptions)}},dependencies:[P,w,b,J,De,Ne,Be,W,ke,Q,Le,Ve,Fe],styles:[".form-container[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:15px}.form-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.description-group[_ngcontent-%COMP%]{flex:2}label[_ngcontent-%COMP%]{font-size:12px;color:#0b3b5b;margin-bottom:5px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:10px;border:1px solid #0B3B5B;border-radius:4px;font-size:14px;color:#0b3b5b}textarea[_ngcontent-%COMP%]{resize:vertical;min-height:60px;color:#0b3b5b}.error-message[_ngcontent-%COMP%]{color:#fcacc4;font-size:12px;margin-top:5px}.share-options-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;max-height:100px;overflow-y:auto;border:1px solid #0B3B5B;border-radius:4px;padding:10px;scroll-behavior:smooth;scrollbar-color:transparent #0B3B5B}.share-option[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:70px;padding:6px 12px;background:#0b3b5b1a;border-radius:15px;cursor:pointer;transition:all .2s}.share-option.selected[_ngcontent-%COMP%]{background:#fcacc4;color:#fff}.share-name[_ngcontent-%COMP%]{font-size:12px;color:#0b3b5b}"]})};var Je=r=>({"max-height":r});function Ke(r,t){if(r&1&&(n(0,"p",25),d(1),s()),r&2){let e=l().$implicit;a(),M("",e.price," KM")}}function Ye(r,t){if(r&1&&(n(0,"p",26),d(1),s()),r&2){let e=l().$implicit;a(),_(e.storeName)}}function Xe(r,t){if(r&1){let e=h();n(0,"div",12)(1,"div",13),v(2,"img",14),s(),n(3,"div",15)(4,"p",16),d(5),s(),u(6,Ke,2,1,"p",17)(7,Ye,2,1,"p",18),s(),n(8,"div",19)(9,"div",20)(10,"button",21),f("click",function(){let o=m(e).$implicit,c=l(2);return g(c.updateItemQuantity(o.id,(o.quantity||1)-1))}),d(11,"-"),s(),n(12,"span",22),d(13),s(),n(14,"button",23),f("click",function(){let o=m(e).$implicit,c=l(2);return g(c.updateItemQuantity(o.id,(o.quantity||1)+1))}),d(15,"+"),s()(),n(16,"button",24),f("click",function(){let o=m(e).$implicit,c=l(2);return g(c.onRemoveProduct(o))}),d(17,"\xD7"),s()()()}if(r&2){let e=t.$implicit;a(2),p("alt",e.productName),a(3),_(e.productName),a(),p("ngIf",e.price),a(),p("ngIf",e.storeName),a(3),p("disabled",(e.quantity||1)<=1),a(3),_(e.quantity||1)}}function Ze(r,t){if(r&1&&(n(0,"div",27)(1,"p")(2,"strong"),d(3,"Total Items:"),s(),d(4),s()()),r&2){let e=l(2);a(4),M(" ",e.selectedProducts.length,"")}}function et(r,t){if(r&1&&(n(0,"div",8)(1,"div",9),u(2,Xe,18,6,"div",10),s(),u(3,Ze,5,1,"div",11),s()),r&2){let e=l();a(),p("ngStyle",ve(3,Je,e.getContainerHeight())),a(),p("ngForOf",e.selectedProducts),a(),p("ngIf",e.selectedProducts.length>0)}}function tt(r,t){r&1&&(n(0,"div",28),v(1,"img",29),s(),n(2,"p",30),d(3,"The List is still empty! "),v(4,"br"),d(5," Once you select the products you would like to add, they will appear here!"),s())}function it(r,t){if(r&1){let e=h();n(0,"button",31),f("click",function(){m(e);let o=l();return g(o.onCancelEdit())}),d(1,"CANCEL"),s()}}var X=class r{selectedProducts=[];isEditMode=!1;preferredStore=null;listFormValid=!1;quantityChange=new C;removeProduct=new C;saveList=new C;cancelEdit=new C;changeStore=new C;updateProductStore=new C;previousStore=null;ngOnChanges(t){if(t.preferredStore&&!t.preferredStore.firstChange){let e=t.preferredStore.currentValue,i=t.preferredStore.previousValue;e!==i&&e&&this.switchSelectedItemsToNewStore(e)}}switchSelectedItemsToNewStore(t){this.selectedProducts.forEach(e=>{this.updateProductStore.emit({productId:e.id,newStore:t})})}getContainerHeight(){return`${Math.min(100+this.selectedProducts.length*70,300)}px`}updateItemQuantity(t,e){e>0&&this.quantityChange.emit({id:t,quantity:e})}onRemoveProduct(t){this.removeProduct.emit(t)}onSaveList(){this.saveList.emit()}onCancelEdit(){this.cancelEdit.emit()}onChangeStore(){this.changeStore.emit()}getTotalPrice(){return this.selectedProducts.reduce((t,e)=>t+(e.price||0)*(e.quantity||1),0)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=S({type:r,selectors:[["app-selected-products"]],inputs:{selectedProducts:"selectedProducts",isEditMode:"isEditMode",preferredStore:"preferredStore",listFormValid:"listFormValid"},outputs:{quantityChange:"quantityChange",removeProduct:"removeProduct",saveList:"saveList",cancelEdit:"cancelEdit",changeStore:"changeStore",updateProductStore:"updateProductStore"},features:[q],decls:14,vars:6,consts:[["emptyList",""],["id","list-header"],["class","list-preview-content",4,"ngIf","ngIfElse"],[1,"list-instruction"],[1,"info-icon"],[1,"action-buttons"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"create-list-btn",3,"click","disabled"],[1,"list-preview-content"],[1,"selected-items-container",3,"ngStyle"],["class","selected-item",4,"ngFor","ngForOf"],["class","list-total",4,"ngIf"],[1,"selected-item"],[1,"selected-item-image"],["src","assets/images/item-img-generic.png","height","50","width","50",3,"alt"],[1,"selected-item-details"],[1,"selected-item-name"],["class","selected-item-price",4,"ngIf"],["class","selected-item-store",4,"ngIf"],[1,"selected-item-actions"],[1,"quantity-control"],[1,"quantity-btn",3,"click","disabled"],[1,"quantity-value"],[1,"quantity-btn",3,"click"],["title","Remove item",1,"remove-item-btn",3,"click"],[1,"selected-item-price"],[1,"selected-item-store"],[1,"list-total"],[1,"list-preview-image"],["src","assets/images/shopping-list-icon.png","alt","Shopping List","height","400","width","400"],[1,"list-info"],[1,"secondary-btn",3,"click"]],template:function(e,i){if(e&1){let o=h();n(0,"h2",1),d(1),s(),u(2,et,4,5,"div",2)(3,tt,6,0,"ng-template",null,0,V),n(5,"div",3)(6,"mat-icon",4),d(7,"info"),s(),n(8,"span"),d(9,"Remember you can use your points to get discounts in our partnering stores"),s()(),n(10,"div",5),u(11,it,2,0,"button",6),n(12,"button",7),f("click",function(){return m(o),g(i.onSaveList())}),d(13),s()()}if(e&2){let o=D(4);a(),_(i.isEditMode?"Edit Shopping List":"Shopping List"),a(),p("ngIf",i.selectedProducts.length>0)("ngIfElse",o),a(9),p("ngIf",i.isEditMode),a(),p("disabled",!i.listFormValid||i.selectedProducts.length===0),a(),M(" ",i.isEditMode?"UPDATE LIST":"CREATE A LIST"," ")}},dependencies:[P,w,b,ye,L,T],styles:["#list-header[_ngcontent-%COMP%]{color:#0b3b5b}.shopping-list-preview[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a;display:flex;flex-direction:column;align-items:center;text-align:center;height:550px;scroll-behavior:smooth;scrollbar-color:#FCACC4 white}.list-preview-content[_ngcontent-%COMP%]{position:relative;width:100%;flex:1;display:flex;flex-direction:column;overflow:hidden}.selected-items-container[_ngcontent-%COMP%]{width:100%;flex:1;overflow-y:auto;margin-bottom:20px;min-height:100px;max-height:300px;scroll-behavior:smooth;transition:max-height .3s ease}.selected-item[_ngcontent-%COMP%]{display:flex;align-items:center;border-bottom:1px solid #0B3B5B;padding:10px 0}.selected-item-image[_ngcontent-%COMP%]{width:50px;height:50px;margin-right:10px;display:flex;justify-content:center;align-items:center}.selected-item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.selected-item-details[_ngcontent-%COMP%]{flex:1;text-align:left}.selected-item-name[_ngcontent-%COMP%]{font-size:14px;margin:0 0 5px}.selected-item-price[_ngcontent-%COMP%], .selected-item-store[_ngcontent-%COMP%]{font-size:12px;color:#0b3b5bb3;margin:0}.selected-item-actions[_ngcontent-%COMP%]{display:flex;align-items:center}.quantity-control[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:10px}.quantity-btn[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;border:1px solid #0B3B5B;background:#fff;display:flex;justify-content:center;align-items:center;font-size:18px;cursor:pointer;color:#0b3b5b}.quantity-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.quantity-value[_ngcontent-%COMP%]{margin:0 8px;font-size:14px;min-width:20px;text-align:center}.remove-item-btn[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;border:none;background:#fcacc4;color:#fff;font-size:18px;cursor:pointer;display:flex;justify-content:center;align-items:center;line-height:1}.list-total[_ngcontent-%COMP%]{width:100%;padding-top:10px;text-align:right}.list-preview-image[_ngcontent-%COMP%]{height:200px;margin:20px 0;display:flex;justify-content:center;align-items:center}.list-preview-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.list-info[_ngcontent-%COMP%]{font-size:14px;color:#0b3b5b;margin-bottom:20px}.list-instruction[_ngcontent-%COMP%]{display:flex;gap:10px;font-size:12px;color:#0b3b5bb3;margin-bottom:20px;padding:10px;background:#f5f5f5;border-radius:4px;width:100%;align-items:center}.info-icon[_ngcontent-%COMP%]{font-size:16px}.action-buttons[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;gap:10px;margin-top:auto}.create-list-btn[_ngcontent-%COMP%], .secondary-btn[_ngcontent-%COMP%]{padding:12px 24px;border-radius:4px;font-weight:700;cursor:pointer;border:none}.create-list-btn[_ngcontent-%COMP%]{background:#fcacc4cc;color:#fff}.create-list-btn[_ngcontent-%COMP%]:hover{background:#fcacc4}.create-list-btn[_ngcontent-%COMP%]:disabled{background:#ffb6c1;cursor:not-allowed}.secondary-btn[_ngcontent-%COMP%]{background:#f0f0f0;color:#0b3b5b}.secondary-btn[_ngcontent-%COMP%]:hover{background:#0b3b5b1a}"]})};function ot(r,t){r&1&&(n(0,"mat-icon",15),d(1,"favorite"),s())}function rt(r,t){r&1&&(n(0,"mat-icon",15),d(1,"attach_money"),s())}function nt(r,t){r&1&&(n(0,"mat-icon",15),d(1,"group"),s())}function st(r,t){r&1&&(n(0,"mat-icon",15),d(1,"category"),s())}function at(r,t){if(r&1&&(n(0,"div",28)(1,"span",29),d(2),s()()),r&2){let e=l().$implicit,i=l(3);a(2),_(i.getProductQuantity(e.productId))}}function ct(r,t){if(r&1&&(n(0,"p",30),d(1),s()),r&2){let e=l().$implicit;a(),_(e.storeName)}}function lt(r,t){if(r&1&&(n(0,"p",31),d(1),s()),r&2){let e=l().$implicit;a(),M("",e.price," KM")}}function dt(r,t){if(r&1){let e=h();n(0,"div",19),f("click",function(){let o=m(e).$implicit,c=l(3);return g(c.selectProduct(o))}),n(1,"div",20),v(2,"img",21),u(3,at,3,1,"div",22),s(),n(4,"div",23)(5,"p",24),d(6),s(),u(7,ct,2,1,"p",25)(8,lt,2,1,"p",26),n(9,"button",27),f("click",function(o){let c=m(e).$implicit,x=l(3);return g(x.compareStoreItems(c.id,o))}),d(10," Compare prices "),s()()()}if(r&2){let e=t.$implicit,i=l(3);E("selected",i.isProductSelected(e.productId)),a(2),p("src","assets/images/"+e.image||"assets/images/item-img-generic.png",A)("alt",e.productName),a(),p("ngIf",i.isProductSelected(e.productId)),a(3),_(e.productName),a(),p("ngIf",e.storeName),a(),p("ngIf",e.price)}}function pt(r,t){if(r&1&&(n(0,"div",16)(1,"div",17),u(2,dt,11,8,"div",18),s()()),r&2){let e=l().$implicit;a(2),p("ngForOf",e.products)}}function mt(r,t){if(r&1){let e=h();n(0,"div",7)(1,"div",8),f("click",function(){let o=m(e).$implicit,c=l();return g(c.toggleCategory(o))}),n(2,"h3",9),me(3,10),u(4,ot,2,0,"mat-icon",11)(5,rt,2,0,"mat-icon",11)(6,nt,2,0,"mat-icon",11)(7,st,2,0,"mat-icon",12),ge(),d(8),s(),n(9,"mat-icon",13),d(10),s()(),u(11,pt,3,1,"div",14),s()}if(r&2){let e=t.$implicit,i=l();a(3),p("ngSwitch",e.id),a(),p("ngSwitchCase","favorite"),a(),p("ngSwitchCase","best-price"),a(),p("ngSwitchCase","peoples-choice"),a(2),M(" ",e.name," "),a(2),_(i.isCategoryExpanded(e)?"expand_less":"expand_more"),a(),p("ngIf",i.isCategoryExpanded(e))}}var Z=class r{filteredProducts=[];selectedProducts=[];categories=[];searchTerm="";searchChange=new C;toggleCategoryEvent=new C;selectProductEvent=new C;comparePricesEvent=new C;collapsedCategories=new Set;onSearchInput(){this.searchChange.emit(this.searchTerm)}toggleCategory(t){this.collapsedCategories.has(t.id)?this.collapsedCategories.delete(t.id):this.collapsedCategories.add(t.id),this.toggleCategoryEvent.emit(t)}selectProduct(t){this.selectProductEvent.emit(t)}compareStoreItems(t,e){e.stopPropagation(),this.comparePricesEvent.emit(t)}isProductSelected(t){return this.selectedProducts.some(e=>e.productId===t)}getProductQuantity(t){return this.selectedProducts.find(i=>i.productId===t)?.quantity||0}isCategoryExpanded(t){return!this.collapsedCategories.has(t.id)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=S({type:r,selectors:[["app-product-list"]],inputs:{filteredProducts:"filteredProducts",selectedProducts:"selectedProducts",categories:"categories",searchTerm:"searchTerm"},outputs:{searchChange:"searchChange",toggleCategoryEvent:"toggleCategoryEvent",selectProductEvent:"selectProductEvent",comparePricesEvent:"comparePricesEvent"},decls:9,vars:3,consts:[[1,"search-box"],[1,"item-count"],[1,"search-input"],["type","text","placeholder","Search Products",3,"ngModelChange","input","ngModel"],[1,"search-icon"],[1,"categories-container"],["class","category",4,"ngFor","ngForOf"],[1,"category"],[1,"category-header",3,"click"],[1,"category-title"],[3,"ngSwitch"],["class","category-icon",4,"ngSwitchCase"],["class","category-icon",4,"ngSwitchDefault"],[1,"expand-icon"],["class","products-container",4,"ngIf"],[1,"category-icon"],[1,"products-container"],[1,"product-row"],["class","product-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"product-item",3,"click"],[1,"product-image"],["height","100","width","100",3,"src","alt"],["class","selection-indicator",4,"ngIf"],[1,"product-details"],[1,"product-name"],["class","product-store",4,"ngIf"],["class","product-price",4,"ngIf"],[1,"compare-btn",3,"click"],[1,"selection-indicator"],[1,"quantity"],[1,"product-store"],[1,"product-price"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"p",1),d(2),s(),n(3,"div",2)(4,"input",3),Ce("ngModelChange",function(c){return xe(i.searchTerm,c)||(i.searchTerm=c),c}),f("input",function(){return i.onSearchInput()}),s(),n(5,"mat-icon",4),d(6,"search"),s()()(),n(7,"div",5),u(8,mt,12,7,"div",6),s()),e&2&&(a(2),M("",i.filteredProducts.length," Products"),a(2),_e("ngModel",i.searchTerm),a(4),p("ngForOf",i.categories))},dependencies:[P,w,b,Se,be,Pe,G,W,Q,Ee,L,T],styles:[".products-section[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;display:flex;flex-direction:column;overflow:hidden;height:100%}.search-box[_ngcontent-%COMP%]{padding:15px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #0B3B5B;background:#0b3b5b1a;position:relative;z-index:10;color:#0b3b5b}.item-count[_ngcontent-%COMP%]{font-size:12px;color:#0b3b5b;margin:0}.search-input[_ngcontent-%COMP%]{position:relative;width:250px}.search-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:8px 30px 8px 10px;border-radius:15px;border:1px solid #0B3B5B;color:#0b3b5b}.search-icon[_ngcontent-%COMP%]{position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#0b3b5b}.categories-container[_ngcontent-%COMP%]{overflow-y:auto;flex:1;position:relative;z-index:5}.category[_ngcontent-%COMP%]{border-bottom:1px solid #0B3B5B}.category-header[_ngcontent-%COMP%]{padding:15px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:#0b3b5b1a}.category-title[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:700;display:flex;align-items:center}.category-icon[_ngcontent-%COMP%]{margin-right:10px;color:#0b3b5b}.expand-icon[_ngcontent-%COMP%]{font-size:25px;color:#0b3b5b}.products-container[_ngcontent-%COMP%]{padding:15px}.product-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}.product-item[_ngcontent-%COMP%]{border:1px solid #0B3B5B;border-radius:8px;padding:10px;cursor:pointer;position:relative;transition:all .2s}.product-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #0000001a}.product-item.selected[_ngcontent-%COMP%]{border-color:#fcacc4;background-color:#ff5c8d0d}.product-image[_ngcontent-%COMP%]{width:100%;height:100px;display:flex;justify-content:center;align-items:center;margin-bottom:10px}.product-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.product-details[_ngcontent-%COMP%]{font-size:12px}.product-name[_ngcontent-%COMP%]{font-weight:700;margin:0 0 5px}.product-store[_ngcontent-%COMP%], .product-price[_ngcontent-%COMP%]{margin:0 0 5px;color:#0b3b5b}.compare-btn[_ngcontent-%COMP%]{font-size:11px;background:transparent;border:1px solid #0B3B5B;border-radius:12px;padding:3px 8px;color:#0b3b5b;cursor:pointer;margin-top:5px}.compare-btn[_ngcontent-%COMP%]:hover{background:#0b3b5b33}.selection-indicator[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:20px;height:20px;background:#fcacc4;color:#fff;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:12px}"]})};function ut(r,t){if(r&1&&(n(0,"div",11)(1,"div",12),v(2,"img",13),s(),n(3,"div",14)(4,"h4"),d(5),s()()()),r&2){let e=l(3);a(2),p("src","assets/images/"+e.selectedProduct.image||"assets/images/item-img-generic.png",A)("alt",e.selectedProduct.productName),a(3),_(e.selectedProduct.productName)}}function ft(r,t){r&1&&(n(0,"div",22)(1,"mat-icon"),d(2,"check_circle"),s(),n(3,"span"),d(4,"Current Store"),s()())}function ht(r,t){if(r&1){let e=h();n(0,"div",15),f("click",function(){let o=m(e).$implicit,c=l(3);return g(c.onStoreSelect(o))}),n(1,"div",16),v(2,"span",17),n(3,"span",18),d(4),s()(),n(5,"div",19)(6,"span",20),d(7),s(),u(8,ft,5,0,"div",21),s()()}if(r&2){let e=t.$implicit,i=l(3);E("preferred",e.storeName===i.preferredStore),a(2),p("innerHTML",i.getSafeSvg(e.storeIcon),R),a(2),_(e.storeName),a(3),M("",e.price," KM"),a(),p("ngIf",e.storeName===i.preferredStore)}}function _t(r,t){if(r&1&&(n(0,"div",7),u(1,ut,6,3,"div",8),n(2,"div",9),u(3,ht,9,6,"div",10),s()()),r&2){let e=l(2);a(),p("ngIf",e.selectedProduct),a(2),p("ngForOf",e.storeComparisons)}}function xt(r,t){r&1&&(n(0,"div",23),v(1,"div",24),n(2,"p",25),d(3,"Loading price comparisons..."),s()())}function Ct(r,t){if(r&1){let e=h();n(0,"div",2),f("click",function(){m(e);let o=l();return g(o.onBackdropClick())}),n(1,"div",3),f("click",function(o){m(e);let c=l();return g(c.onContentClick(o))}),n(2,"div",4)(3,"h3"),d(4,"Compare Store Prices"),s(),n(5,"button",5),f("click",function(){m(e);let o=l();return g(o.onClose())}),d(6,"\xD7"),s()(),u(7,_t,4,2,"div",6)(8,xt,4,0,"ng-template",null,0,V),s()()}if(r&2){let e=D(9),i=l();a(7),p("ngIf",!i.isLoading)("ngIfElse",e)}}var ee=class r{constructor(t){this.sanitizer=t}show=!1;isLoading=!1;storeComparisons=[];selectedProduct=null;preferredStore=null;product=null;closeModal=new C;storeSelected=new C;onClose(){this.closeModal.emit()}onStoreSelect(t){this.storeSelected.emit(t)}getSafeSvg(t){return this.sanitizer.bypassSecurityTrustHtml(t)}onBackdropClick(){this.closeModal.emit()}onContentClick(t){t.stopPropagation()}static \u0275fac=function(e){return new(e||r)(I(H))};static \u0275cmp=S({type:r,selectors:[["app-price-comparison-modal"]],inputs:{show:"show",isLoading:"isLoading",storeComparisons:"storeComparisons",selectedProduct:"selectedProduct",preferredStore:"preferredStore",product:"product"},outputs:{closeModal:"closeModal",storeSelected:"storeSelected"},decls:1,vars:1,consts:[["loadingPrices",""],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content","price-comparison-modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],["class","modal-body",4,"ngIf","ngIfElse"],[1,"modal-body"],["class","product-info",4,"ngIf"],[1,"store-prices"],["class","store-price-item",3,"preferred","click",4,"ngFor","ngForOf"],[1,"product-info"],[1,"product-image"],[3,"src","alt"],[1,"product-details"],[1,"store-price-item",3,"click"],[1,"store-info"],[1,"store-logo",3,"innerHTML"],[1,"store-name"],[1,"price-info"],[1,"price"],["class","store-indicator",4,"ngIf"],[1,"store-indicator"],[1,"loading-container"],[1,"loading-spinner"],[2,"color","#0B3B5B"]],template:function(e,i){e&1&&u(0,Ct,10,2,"div",1),e&2&&p("ngIf",i.show)},dependencies:[P,w,b,L,T],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 4px 8px #0003}.price-comparison-modal[_ngcontent-%COMP%]{width:100%;max-width:450px}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border-bottom:1px solid #0B3B5B}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#0b3b5b}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer;color:#0b3b5b}.modal-body[_ngcontent-%COMP%]{padding:20px}.product-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid #eee}.product-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80px;height:80px;object-fit:cover;border-radius:8px}.product-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-size:1.2em}.store-prices[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.store-price-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px;border-radius:8px;border:1px solid #0B3B5B;cursor:pointer;transition:all .2s ease}.store-price-item[_ngcontent-%COMP%]:hover{background-color:#0b3b5b1a;transform:translateY(-2px);box-shadow:0 4px 8px #0000000d}.store-price-item.preferred[_ngcontent-%COMP%]{border-color:#0b3b5b;background-color:#0b3b5b59}.store-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.store-logo[_ngcontent-%COMP%]{display:flex;width:32px;height:32px}.store-name[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.price-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:5px}.price[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#0b3b5b}.store-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;color:#0b3b5b;font-size:12px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:40px 20px}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #FCACC4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};function vt(r,t){r&1&&(n(0,"div",19)(1,"mat-icon"),d(2,"check_circle"),s()())}function St(r,t){if(r&1){let e=h();n(0,"div",14),f("click",function(){let o=m(e).$implicit,c=l(3);return g(c.onStoreSelect(o))}),n(1,"div",15),v(2,"span",16),n(3,"span",17),d(4),s()(),u(5,vt,3,0,"div",18),s()}if(r&2){let e=t.$implicit,i=l(3);E("selected",e.name===i.preferredStore),a(2),p("innerHTML",i.getSafeSvg(e.icon),R)("title",e.name),a(2),_(e.name),a(),p("ngIf",e.name===i.preferredStore)}}function bt(r,t){if(r&1){let e=h();n(0,"button",20),f("click",function(){m(e);let o=l(3);return g(o.onClearStore())}),d(1," Clear Store Preference "),s()}}function Pt(r,t){if(r&1&&(n(0,"div",7)(1,"p",8),d(2," Choose your preferred store. All products in your list will be updated to this store when available. "),s(),n(3,"div",9)(4,"div",10),u(5,St,6,6,"div",11),s()(),n(6,"div",12),u(7,bt,2,0,"button",13),s()()),r&2){let e=l(2);a(5),p("ngForOf",e.stores),a(2),p("ngIf",e.preferredStore)}}function yt(r,t){r&1&&(n(0,"div",21),v(1,"div",22),n(2,"p",23),d(3,"Loading stores..."),s()())}function Ot(r,t){if(r&1){let e=h();n(0,"div",2),f("click",function(){m(e);let o=l();return g(o.onBackdropClick())}),n(1,"div",3),f("click",function(o){m(e);let c=l();return g(c.onContentClick(o))}),n(2,"div",4)(3,"h3"),d(4,"Select Preferred Store"),s(),n(5,"button",5),f("click",function(){m(e);let o=l();return g(o.onClose())}),d(6,"\xD7"),s()(),u(7,Pt,8,2,"div",6)(8,yt,4,0,"ng-template",null,0,V),s()()}if(r&2){let e=D(9),i=l();a(7),p("ngIf",!i.isLoading)("ngIfElse",e)}}var te=class r{constructor(t){this.sanitizer=t}show=!1;stores=[];preferredStore=null;isLoading=!1;currentStore=null;closeModal=new C;storeSelected=new C;clearStore=new C;onClose(){this.closeModal.emit()}onStoreSelect(t){this.storeSelected.emit(t)}onClearStore(){this.clearStore.emit()}getSafeSvg(t){return this.sanitizer.bypassSecurityTrustHtml(t)}onBackdropClick(){this.closeModal.emit()}onContentClick(t){t.stopPropagation()}isStoreSelected(t){return t.name===this.currentStore}static \u0275fac=function(e){return new(e||r)(I(H))};static \u0275cmp=S({type:r,selectors:[["app-store-selection-modal"]],inputs:{show:"show",stores:"stores",preferredStore:"preferredStore",isLoading:"isLoading",currentStore:"currentStore"},outputs:{closeModal:"closeModal",storeSelected:"storeSelected",clearStore:"clearStore"},decls:1,vars:1,consts:[["loadingStores",""],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content","store-selection-modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],["class","modal-body",4,"ngIf","ngIfElse"],[1,"modal-body"],[1,"store-selection-info"],[1,"store-options"],[1,"store-list"],["class","store-item",3,"selected","click",4,"ngFor","ngForOf"],[1,"store-selection-actions"],["class","clear-store-btn",3,"click",4,"ngIf"],[1,"store-item",3,"click"],[1,"store-info"],[1,"store-logo",3,"innerHTML","title"],[1,"store-name"],["class","store-selection-indicator",4,"ngIf"],[1,"store-selection-indicator"],[1,"clear-store-btn",3,"click"],[1,"loading-container"],[1,"loading-spinner"],[2,"color","#0B3B5B"]],template:function(e,i){e&1&&u(0,Ot,10,2,"div",1),e&2&&p("ngIf",i.show)},dependencies:[P,w,b,L,T],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;box-shadow:0 4px 8px #0003}.store-selection-modal[_ngcontent-%COMP%]{width:100%;max-width:450px;scroll-behavior:smooth;scrollbar-color:#0B3B5B white}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border-bottom:1px solid #0B3B5B}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#0b3b5b}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer;color:#0b3b5b}.modal-body[_ngcontent-%COMP%]{padding:20px}.store-selection-info[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center;color:#0b3b5b}.store-options[_ngcontent-%COMP%], .store-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.store-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px;border-radius:8px;border:1px solid #0B3B5B;cursor:pointer;transition:all .2s ease}.store-item[_ngcontent-%COMP%]:hover{background-color:#0b3b5b1a;transform:translateY(-2px);box-shadow:0 4px 8px #0000000d}.store-item.selected[_ngcontent-%COMP%]{border-color:#0b3b5b;background-color:#0b3b5b59}.store-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.store-logo[_ngcontent-%COMP%]{display:flex;width:32px;height:32px}.store-name[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.store-selection-indicator[_ngcontent-%COMP%]{color:#0b3b5b}.store-selection-actions[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:center}.clear-store-btn[_ngcontent-%COMP%]{padding:8px 16px;background-color:#0b3b5b;border:1px solid #0B3B5B;border-radius:4px;cursor:pointer;font-size:14px;transition:all .2s ease;color:#fff}.clear-store-btn[_ngcontent-%COMP%]:hover{background-color:#092a40}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:40px 20px}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #FCACC4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};var ie=class r{constructor(t){this.http=t}apiUrl=`${Ie.apiUrl}/api/shopping-lists`;getCategories(){return this.http.get(`${this.apiUrl}/categories`)}getSidebarCategories(){return this.http.get(`${this.apiUrl}/sidebar-categories`)}getAllProducts(){return this.http.get(`${this.apiUrl}/products`)}getListById(t){return this.http.get(`${this.apiUrl}/${t}`)}getListsByUserId(t){return this.http.get(`${this.apiUrl}/user/${t}`)}createList(t){return this.http.post(`${this.apiUrl}`,t)}updateList(t,e){return this.http.put(`${this.apiUrl}/${t}`,e)}softDeleteList(t){return this.http.put(`${this.apiUrl}/${t}/soft-delete`,{})}getCollaborators(t){return this.http.get(`${this.apiUrl}/${t}/collaborators`)}searchProducts(t){return this.http.get(`${this.apiUrl}/products/search`,{params:{term:t}})}getProductsByCategory(t){return this.http.get(`${this.apiUrl}/products/category/${t}`)}getItemPriceComparisons(t){return this.http.get(`${this.apiUrl}/items/${t}/price-comparisons`)}getAllAvailableStores(){return this.http.get(`${this.apiUrl}/stores`)}updateShoppingList(t,e){return this.http.put(`${this.apiUrl}/${t}/update`,e)}static \u0275fac=function(e){return new(e||r)(pe(Oe))};static \u0275prov=de({token:r,factory:r.\u0275fac,providedIn:"root"})};function Mt(r,t){if(r&1){let e=h();n(0,"div",8)(1,"div",9)(2,"mat-icon"),d(3,"store"),s(),n(4,"span"),d(5,"Shopping from: "),n(6,"strong"),d(7),s()(),n(8,"button",10),f("click",function(){m(e);let o=l();return g(o.changePreferredStore())}),d(9,"Change"),s()(),n(10,"p",11),d(11),s()()}if(r&2){let e=l();a(7),_(e.preferredStore),a(4),M("Products will be selected from ",e.preferredStore," when available")}}function wt(r,t){if(r&1){let e=h();n(0,"app-store-selection-modal",12),f("closeModal",function(){m(e);let o=l();return g(o.closeStoreSelectionModal())})("storeSelected",function(o){m(e);let c=l();return g(c.onStoreSelected(o))})("clearStore",function(){m(e);let o=l();return o.preferredStore=null,g(o.closeStoreSelectionModal())}),s()}if(r&2){let e=l();p("show",e.showStoreSelectionModal)("stores",e.availableStores)("preferredStore",e.preferredStore)("isLoading",e.isLoading)}}function Tt(r,t){if(r&1){let e=h();n(0,"div",13)(1,"div",14)(2,"app-selected-products",15),f("quantityChange",function(o){m(e);let c=l();return g(c.updateItemQuantity(o))})("removeProduct",function(o){m(e);let c=l();return g(c.removeProduct(o))})("saveList",function(){m(e);let o=l();return g(o.saveList())})("cancelEdit",function(){m(e);let o=l();return g(o.cancelEdit())})("changeStore",function(){m(e);let o=l();return g(o.showStoreSelectionModal=!0)})("updateProductStore",function(o){m(e);let c=l();return g(c.onUpdateProductStore(o))}),s()(),n(3,"div",16)(4,"app-product-list",17),f("searchChange",function(o){m(e);let c=l();return g(c.onSearchInput(o))})("toggleCategoryEvent",function(o){m(e);let c=l();return g(c.toggleCategory(o))})("selectProductEvent",function(o){m(e);let c=l();return g(c.selectProduct(o))})("comparePricesEvent",function(o){m(e);let c=l();return g(c.showPriceComparison(o))}),s()()()}if(r&2){let e=l();a(2),p("selectedProducts",e.selectedProducts)("isEditMode",e.isEditMode)("preferredStore",e.preferredStore)("listFormValid",e.listFormComponent&&e.listFormComponent.isFormValid()||!1),a(2),p("categories",e.categories)("filteredProducts",e.filteredProducts)("selectedProducts",e.selectedProducts)("searchTerm",e.searchTerm)}}function Lt(r,t){if(r&1){let e=h();n(0,"app-price-comparison-modal",20),f("closeModal",function(){m(e);let o=l(2);return g(o.closeComparisonModal())})("storeSelected",function(o){m(e);let c=l(2);return g(c.selectStore(o))}),s()}if(r&2){let e=l(2);p("show",e.showComparisonModal)("selectedProduct",e.selectedComparisonProduct)("storeComparisons",e.storeComparisons)("preferredStore",e.preferredStore)("isLoading",e.isLoadingComparisons)}}function Et(r,t){if(r&1){let e=h();n(0,"div",18),f("click",function(){m(e);let o=l();return g(o.closeComparisonModal())}),u(1,Lt,1,5,"app-price-comparison-modal",19),s()}if(r&2){let e=l();a(),p("ngIf",e.showComparisonModal)}}function Dt(r,t){r&1&&(n(0,"div",21),v(1,"div",22),n(2,"p",23),d(3,"Loading shopping list data..."),s()())}var qe=class r{constructor(t,e,i,o,c){this.route=t;this.router=e;this.shoppingListService=i;this.favoriteProductsService=o;this.loyaltyPointsService=c;let x=localStorage.getItem("userInfo");if(this.userId=x?JSON.parse(x).id:"",!this.userId)throw new Error("User ID not found. Please log in again.")}categories=[];selectedProducts=[];isEditMode=!1;listId=null;searchTerm="";filteredProducts=[];isLoading=!1;currentList=null;originalCategories=[];selectedCategoryId=null;preferredStore=null;showStoreSelectionModal=!1;availableStores=[];sidebarCategories=[];showComparisonModal=!1;storeComparisons=[];selectedComparisonProduct=null;isLoadingComparisons=!1;listFormComponent;formValues=null;initialFormValues={name:"",description:"",listType:"OTHER",shareWith:[]};userId;searchSubject=new re;DEBOUNCE_TIME=300;currentStore=null;favoriteProducts=[];ngOnInit(){this.setupSearch(),this.isLoading=!1,this.route.paramMap.pipe(B(t=>{this.listId=t.get("id")}),N(()=>this.favoriteProductsService.getFavoriteProducts(this.userId).pipe(B(t=>{this.favoriteProducts=t.map(e=>O(y({},e),{isChecked:!1,quantity:1,price:0,storeId:"",storeName:""}))}),N(()=>this.shoppingListService.getAllProducts()),B(t=>{this.filteredProducts=t}),N(()=>this.shoppingListService.getSidebarCategories()))),B(t=>{let e={id:"favorite",name:"Favorites",icon:"favorite",products:[]};this.sidebarCategories=[e,...t]}),N(()=>this.shoppingListService.getCategories()),B(t=>{let e={id:"favorite",name:"Favorites",icon:"favorite",products:this.getFavoriteProducts()},i=t.some(o=>o.id==="favorite");this.categories=i?t:[e,...t],this.originalCategories=JSON.parse(JSON.stringify(this.categories))}),N(()=>this.listId?this.shoppingListService.getListById(this.listId):ne(null)),U(()=>{this.isLoading=!1})).subscribe(t=>{t&&(this.currentList=t,this.isEditMode=this.hasEditPermission(),this.loadListData(t))})}setupSearch(){this.searchSubject.pipe(ce(this.DEBOUNCE_TIME),le()).subscribe(t=>{this.performSearch(t)})}searchProducts(t){let e=t||this.searchTerm;this.searchSubject.next(e)}performSearch(t){if(!t.trim()){this.getAllProducts(),this.updateCategoriesWithSearchResults([]);return}this.isLoading=!0,this.shoppingListService.searchProducts(t).subscribe(e=>{this.filteredProducts=e,this.updateCategoriesWithSearchResults(e),this.isLoading=!1})}loadListData(t){this.currentList=t,this.initialFormValues={name:t.name,description:t.description||"",listType:t.listType||"OTHER",shareWith:t.collaborators?t.collaborators.map(e=>e.userId):[]},this.listFormComponent&&this.listFormComponent.reset(),this.selectedProducts=[...t.items],this.preferredStore=t.storeName??null,t.storeId&&t.storeName&&(this.currentStore={id:t.storeId,name:t.storeName,icon:""}),this.filteredProducts=this.filteredProducts.map(e=>{let i=t.items.find(o=>o.productId===e.productId);return i?O(y({},e),{storeName:i.storeName,storeId:i.storeId,price:i.price}):e}),this.preferredStore&&this.updateProductPricesForStore(this.preferredStore)}onFormValuesChange(t){this.formValues=t}getAllProducts(){this.shoppingListService.getAllProducts().subscribe({next:t=>{this.filteredProducts=t.map(e=>{let i=this.selectedProducts.find(o=>o.id===e.id);return i?O(y({},e),{storeName:i.storeName,price:i.price}):e}),this.categories=JSON.parse(JSON.stringify(this.originalCategories))},error:t=>{console.error("Error loading products:",t)}})}filterByCategory(t){this.selectedCategoryId=t,this.isLoading=!0,this.searchTerm="",this.selectedCategoryId==="default"?this.shoppingListService.getAllProducts().subscribe(e=>{this.filteredProducts=e,this.categories=this.originalCategories,this.isLoading=!1}):this.selectedCategoryId==="favorite"?this.shoppingListService.getAllProducts().subscribe(e=>{this.filteredProducts=e;let i=this.getFavoriteProducts();this.categories=[{id:"favorite",name:"Favorites",icon:"favorite",products:i}],this.isLoading=!1}):this.shoppingListService.getProductsByCategory(t).subscribe(e=>{this.filteredProducts=e,this.categories=this.originalCategories.filter(i=>i.id===t),this.categories.length>0&&(this.categories[0].expanded=!0),this.isLoading=!1})}updateCategoriesWithSearchResults(t){if(!t||t.length===0){this.resetCategoriesToOriginal();return}this.categories.forEach(e=>{e.id==="favorite"?e.products=this.getFavoriteProducts().filter(i=>t.some(o=>o.productId===i.productId)):e.products=[],e.expanded=!1}),t.forEach(e=>{let i=e.category||"general",o=this.categories.find(c=>c.id===i);if(o&&o.id!=="favorite")o.products.push(e),o.expanded=!0;else if(!o){let c=this.categories.find(x=>x.id==="general");c||(c={id:"general",name:"Search Results",products:[]},this.categories.push(c)),c.products.push(e),c.expanded=!0}})}resetCategoriesToOriginal(){this.categories=JSON.parse(JSON.stringify(this.originalCategories))}toggleCategory(t){t.expanded=!t.expanded}onStoreSelected(t){this.preferredStore!==t.name&&(this.currentStore=t,this.preferredStore=t.name,this.showStoreSelectionModal=!1,this.selectedProducts=this.selectedProducts.map(e=>O(y({},e),{storeName:t.name,storeId:t.id})),this.updateProductPricesForStore(t.name))}selectProduct(t){this.selectedProducts.findIndex(i=>i.productId===t.productId)===-1?this.shoppingListService.getItemPriceComparisons(t.productId).subscribe({next:i=>{let o=i.reduce((c,x)=>!c||x.price&&(!c.price||x.price<c.price)?x:c,null);if(o){this.currentStore||(this.currentStore={id:o.storeId,name:o.storeName,icon:o.storeIcon||""},this.preferredStore=o.storeName);let c=i.find(x=>x.storeName===this.currentStore.name);this.selectedProducts=[...this.selectedProducts,O(y({},t),{storeName:this.currentStore.name,storeId:this.currentStore.id,price:c?.price||o.price,quantity:1})]}else this.selectedProducts=[...this.selectedProducts,O(y({},t),{quantity:1})]}}):this.selectedProducts=this.selectedProducts.filter(i=>i.productId!==t.productId)}updateItemQuantity(t){let e=this.selectedProducts.findIndex(i=>i.id===t.id);e!==-1&&t.quantity>0&&(this.selectedProducts=[...this.selectedProducts.slice(0,e),O(y({},this.selectedProducts[e]),{quantity:t.quantity}),...this.selectedProducts.slice(e+1)])}changePreferredStore(){this.showStoreSelectionModal=!0,this.isLoadingComparisons=!0,this.shoppingListService.getAllAvailableStores().subscribe(t=>{this.availableStores=t,this.isLoadingComparisons=!1})}closeStoreSelectionModal(){this.showStoreSelectionModal=!1}saveList(){if(!this.listFormComponent.isFormValid())return;if(!this.currentStore?.id){console.error("Please select a store before saving the list");return}this.isLoading=!0;let t=this.listFormComponent.getFormValues(),e={name:t.name,description:t.description,listType:t.listType,ownerId:this.userId,items:this.selectedProducts.map(o=>O(y({},o),{quantity:o.quantity||1,storeName:this.currentStore.name,storeId:this.currentStore.id})),collaborators:t.shareWith.map(o=>({userId:o,permission:"EDIT"})),active:!0,storeId:this.currentStore.id,storeName:this.currentStore.name},i;this.isEditMode&&this.listId&&this.currentList?i=this.shoppingListService.updateList(this.listId,{id:this.listId,name:t.name,description:t.description,listType:t.listType,ownerId:this.userId,items:e.items,collaborators:t.shareWith.map(o=>({userId:o,permission:"EDIT"})),active:!0,storeId:this.currentStore.id,storeName:this.currentStore.name}):i=this.shoppingListService.createList(e),i.pipe(U(()=>{this.isLoading=!1})).subscribe({next:o=>{o&&(this.router.navigate(["/dashboard"]),this.loyaltyPointsService.awardPointsWithNotification("create_list",1,!0))},error:o=>{console.error("Failed to save shopping list:",o)}})}cancelEdit(){this.router.navigate(["/dashboard"])}compareStoreItems(t){this.isLoadingComparisons=!0,this.showComparisonModal=!0,this.selectedComparisonProduct=this.findProductById(t),this.shoppingListService.getItemPriceComparisons(t).subscribe(e=>{this.storeComparisons=e,this.isLoadingComparisons=!1})}findProductById(t){let e=this.selectedProducts.find(i=>i.productId===t);return e||this.filteredProducts.find(i=>i.productId===t)||null}closeComparisonModal(){this.showComparisonModal=!1,this.selectedComparisonProduct=null,this.storeComparisons=[],this.isLoadingComparisons=!1}selectStore(t){let e=this.preferredStore;this.preferredStore=t.storeName,this.currentStore={id:t.storeId,name:t.storeName,icon:t.storeIcon},this.selectedComparisonProduct&&(this.selectedProducts.some(o=>o.productId===this.selectedComparisonProduct.productId)||(this.selectedProducts=[...this.selectedProducts,O(y({},this.selectedComparisonProduct),{storeName:t.storeName,storeId:t.storeId,price:t.price,quantity:1})])),this.selectedProducts=this.selectedProducts.map(i=>O(y({},i),{storeName:t.storeName,storeId:t.storeId})),this.closeComparisonModal(),this.updateProductPricesForStore(t.storeName)}applyPreferredStoreToList(){this.preferredStore&&this.updateProductPricesForStore(this.preferredStore)}removeProduct(t){this.selectedProducts=this.selectedProducts.filter(e=>e.productId!==t.productId)}ngOnDestroy(){this.searchSubject.complete()}onSearchInput(t){this.searchTerm=t,this.searchSubject.next(t)}showPriceComparison(t){if(this.isLoadingComparisons)return;this.isLoadingComparisons=!0;let e=this.findProductById(t);e?(this.selectedComparisonProduct=e,this.shoppingListService.getItemPriceComparisons(e.productId).subscribe({next:i=>{this.storeComparisons=i,this.showComparisonModal=!0,this.isLoadingComparisons=!1},error:i=>{console.error("Error loading price comparisons:",i),this.isLoadingComparisons=!1}})):this.isLoadingComparisons=!1}updateProductPricesForStore(t){if(!t||this.selectedProducts.length===0||!this.currentStore||this.isLoading)return;this.isLoading=!0;let e=this.selectedProducts.map(i=>this.shoppingListService.getItemPriceComparisons(i.productId).pipe(se(o=>{let c=o.find(x=>x.storeName===t);return O(y({},i),{storeName:t,storeId:this.currentStore?.id,price:c?.price,quantity:i.quantity||1})})));ae(e).pipe(U(()=>this.isLoading=!1)).subscribe({next:i=>{this.selectedProducts=[...i],this.filteredProducts=this.filteredProducts.map(o=>{let c=i.find(x=>x.productId===o.productId);return c?O(y({},o),{storeName:c.storeName,storeId:c.storeId,price:c.price}):o})},error:i=>{console.error("Error updating product prices:",i)}})}onUpdateProductStore(t){this.updateProductPricesForStore(t.newStore)}hasEditPermission(){return this.currentList?this.currentList.ownerId===this.userId?!0:this.currentList.collaborators.find(e=>e.userId===this.userId)?.permission==="EDIT":!1}getFavoriteProducts(){return this.filteredProducts.filter(t=>this.favoriteProducts.some(e=>e.productId===t.productId))}static \u0275fac=function(e){return new(e||r)(I(Me),I(we),I(ie),I(je),I(Ue))};static \u0275cmp=S({type:r,selectors:[["app-shopping-list-page"]],viewQuery:function(e,i){if(e&1&&ue(j,5),e&2){let o;fe(o=he())&&(i.listFormComponent=o.first)}},decls:9,vars:8,consts:[["loadingTemplate",""],[3,"formValuesChange","isEditMode","initialValues"],["class","preferred-store-indicator",4,"ngIf"],[3,"show","stores","preferredStore","isLoading","closeModal","storeSelected","clearStore",4,"ngIf"],[1,"page-container"],[1,"sidebar-container",3,"categorySelected","categories"],["class","shopping-list-container",4,"ngIf","ngIfElse"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"preferred-store-indicator"],[1,"preferred-store-badge"],[1,"clear-store-btn",3,"click"],[1,"store-info-text"],[3,"closeModal","storeSelected","clearStore","show","stores","preferredStore","isLoading"],[1,"shopping-list-container"],[1,"shopping-list-preview"],[3,"quantityChange","removeProduct","saveList","cancelEdit","changeStore","updateProductStore","selectedProducts","isEditMode","preferredStore","listFormValid"],[1,"products-section"],[3,"searchChange","toggleCategoryEvent","selectProductEvent","comparePricesEvent","categories","filteredProducts","selectedProducts","searchTerm"],[1,"modal-overlay",3,"click"],[3,"show","selectedProduct","storeComparisons","preferredStore","isLoading","closeModal","storeSelected",4,"ngIf"],[3,"closeModal","storeSelected","show","selectedProduct","storeComparisons","preferredStore","isLoading"],[1,"loading-container"],[1,"loading-spinner"],[2,"color","#0B3B5B"]],template:function(e,i){if(e&1){let o=h();n(0,"app-list-form",1),f("formValuesChange",function(x){return m(o),g(i.onFormValuesChange(x))}),s(),u(1,Mt,12,2,"div",2)(2,wt,1,4,"app-store-selection-modal",3),n(3,"div",4)(4,"app-sidebar",5),f("categorySelected",function(x){return m(o),g(i.filterByCategory(x))}),s(),u(5,Tt,5,8,"div",6)(6,Et,2,1,"div",7)(7,Dt,4,0,"ng-template",null,0,V),s()}if(e&2){let o=D(8);p("isEditMode",i.isEditMode)("initialValues",i.initialFormValues),a(),p("ngIf",i.preferredStore),a(),p("ngIf",i.showStoreSelectionModal),a(2),p("categories",i.sidebarCategories),a(),p("ngIf",!i.isLoading)("ngIfElse",o),a(),p("ngIf",i.showComparisonModal)}},dependencies:[P,b,G,J,T,L,K,j,X,Z,ee,te],styles:[".page-container[_ngcontent-%COMP%]{display:flex;width:100%;min-height:100vh}.sidebar-container[_ngcontent-%COMP%]{flex:0 0 240px;position:relative;top:40px;height:80vh;overflow-y:auto}.shopping-list-container[_ngcontent-%COMP%]{flex:1;display:grid;grid-template-columns:1fr 360px;grid-template-rows:auto 1fr;gap:20px;padding:20px 0 20px 20px;height:100%;max-width:1200px;margin:0 auto}.shopping-list-preview[_ngcontent-%COMP%]{grid-column:2;grid-row:2;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a;display:flex;flex-direction:column;align-items:center;text-align:center;height:570px;scroll-behavior:smooth;scrollbar-color:#FCACC4 white}.products-section[_ngcontent-%COMP%]{grid-column:1;grid-row:2;background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;display:flex;flex-direction:column;overflow:hidden;height:100%}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;width:100%}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #FCACC4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.store-selection-modal[_ngcontent-%COMP%]{width:100%;max-width:450px;scroll-behavior:smooth;scrollbar-color:#0B3B5B white}.preferred-store-indicator[_ngcontent-%COMP%]{margin:10px 0;padding:10px;background-color:#0b3b5b;border-radius:4px;border-left:4px solid #FCACC4}.preferred-store-badge[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:16px;color:#fcacc4}.preferred-store-badge[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;color:#fcacc4}.preferred-store-badge[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{margin:0 4px}.store-info-text[_ngcontent-%COMP%]{margin:5px 0 0 32px;font-size:14px;color:#fff}.clear-store-btn[_ngcontent-%COMP%]{margin-left:10px;padding:4px 8px;background-color:#fcacc4e6;border:1px solid #FCACC4;color:#fff;border-radius:4px;cursor:pointer;font-size:12px}.clear-store-btn[_ngcontent-%COMP%]:hover{background-color:#fcacc4}"]})};export{qe as ShoppingListPageComponent};
