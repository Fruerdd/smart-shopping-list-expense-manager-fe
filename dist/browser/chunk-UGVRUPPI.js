import{a as Z}from"./chunk-IYNE3RVJ.js";import{a as ee}from"./chunk-GKTJ3MPG.js";import{e as w,g as k}from"./chunk-Y6UGLKWX.js";import{a as D,b as M,c as h,d as G,e as R,g as B,h as j,i as q,k as $,l as L,m as H,n as U,o as z,p as J,q as K,t as Q,u as W,v as X,w as Y}from"./chunk-JYF56DXZ.js";import{Ab as f,Bb as S,Dc as V,Eb as C,Fc as O,Kb as o,Lb as m,Mb as x,Ta as n,Xb as A,Za as b,Zb as I,ba as P,ca as y,db as F,hb as p,ob as c,tb as r,ub as t,vb as u,vc as N,wc as T,zb as E}from"./chunk-VE4VNBXX.js";import"./chunk-EQDQRRRY.js";function ne(d,i){if(d&1&&(r(0,"option",14),o(1),t()),d&2){let e=i.$implicit;c("value",e.storeId),n(),x(" ",e.name," ")}}function de(d,i){if(d&1&&(r(0,"tr")(1,"td"),o(2),t(),r(3,"td"),o(4),A(5,"number"),t(),r(6,"td"),o(7),t()()),d&2){let e=i.$implicit;n(2),m(e.productName),n(2),m(I(5,3,e.price,"1.2-2")),n(3),m(e.barcode||"\u2013")}}function ae(d,i){if(d&1&&(r(0,"div",1)(1,"h2"),o(2),t(),r(3,"h4"),o(4,"Existing Products"),t(),r(5,"table",15)(6,"thead")(7,"tr")(8,"th"),o(9,"Name"),t(),r(10,"th"),o(11,"Price"),t(),r(12,"th"),o(13,"Barcode"),t()()(),r(14,"tbody"),p(15,de,8,6,"tr",16),t()()()),d&2){let e=S();n(2),x("Add Products to ",e.store.name,""),n(13),c("ngForOf",e.existingProducts)}}function ce(d,i){if(d&1&&(r(0,"tr")(1,"td"),o(2),t(),r(3,"td"),o(4),t(),r(5,"td"),o(6),t(),r(7,"td"),o(8),A(9,"number"),t(),r(10,"td"),o(11),t()()),d&2){let e=i.$implicit;n(2),m(e.productName),n(2),m(e.category),n(2),m(e.description),n(2),m(I(9,5,e.price,"1.2-2")),n(3),m(e.barcode)}}function le(d,i){if(d&1){let e=E();r(0,"div",1)(1,"h5"),o(2,"Preview CSV Data"),t(),r(3,"table",17)(4,"thead")(5,"tr")(6,"th"),o(7,"Name"),t(),r(8,"th"),o(9,"Category"),t(),r(10,"th"),o(11,"Description"),t(),r(12,"th"),o(13,"Price"),t(),r(14,"th"),o(15,"Barcode"),t()()(),r(16,"tbody"),p(17,ce,12,8,"tr",16),t()(),r(18,"button",18),f("click",function(){P(e);let l=S();return y(l.onSubmitCsv())}),o(19," Upload CSV Products "),t()()}if(d&2){let e=S();n(17),c("ngForOf",e.csvProducts)}}function se(d,i){if(d&1){let e=E();r(0,"button",37),f("click",function(){P(e);let l=S().index,s=S();return y(s.removeProductRow(l))}),o(1," Remove "),t()}}function me(d,i){if(d&1&&(r(0,"div",19)(1,"div",20)(2,"h5"),o(3),t()(),r(4,"div",21)(5,"div",22)(6,"label",23),o(7,"Store"),t(),u(8,"input",24),t(),r(9,"div",22)(10,"label",23),o(11,"Product Name"),t(),u(12,"input",25),t(),r(13,"div",26)(14,"div",27)(15,"label",23),o(16,"Category"),t(),u(17,"input",28),t(),r(18,"div",27)(19,"label",23),o(20,"Description"),t(),u(21,"input",29),t()(),r(22,"div",26)(23,"div",27)(24,"label",23),o(25,"Price"),t(),u(26,"input",30),t(),r(27,"div",27)(28,"label",23),o(29,"Barcode"),t(),u(30,"input",31),t()(),r(31,"div",32),u(32,"input",33),r(33,"label",34),o(34," Active "),t()(),r(35,"div",35),p(36,se,2,0,"button",36),t()()()),d&2){let e=i.index,a=S();c("formGroupName",e),n(3),x("New Product ",e+1,""),n(5),c("value",a.store==null?null:a.store.name),n(24),C("id","isActive",e,""),n(),C("for","isActive",e,""),n(3),c("ngIf",a.productsArray.length>1)}}var te=class d{constructor(i,e,a,l,s){this.fb=i;this.route=e;this.router=a;this.storeSvc=l;this.productSvc=s}productsForm;csvProducts=[];storeId=null;store=null;stores=[];existingProducts=[];ngOnInit(){this.productsForm=this.fb.group({products:this.fb.array([this.createProductGroup()])}),this.storeSvc.getStores().subscribe(i=>this.stores=i),this.route.paramMap.subscribe(i=>{let e=i.get("storeId");e?(this.storeId=e,this.loadStore(e),this.loadExisting(e),this.patchStoreIdToForm(e)):(this.storeId=null,this.store=null,this.existingProducts=[])})}get productsArray(){return this.productsForm.get("products")}createProductGroup(){return this.fb.group({storeId:[this.storeId,h.required],productName:["",h.required],category:[""],description:[""],price:[0,[h.required,h.min(0)]],barcode:[""],isActive:[!0]})}patchStoreIdToForm(i){this.productsArray.controls.forEach(e=>e.patchValue({storeId:i}))}addProductRow(){let i=this.createProductGroup();this.storeId&&i.patchValue({storeId:this.storeId}),this.productsArray.push(i)}removeProductRow(i){this.productsArray.removeAt(i)}onStoreSelected(i){i?this.router.navigate(["/admin-page/add-products",i]):this.router.navigate(["/admin-page/add-products"])}onSubmit(){if(!this.productsForm.valid)return;let i=this.productsForm.value.products;this.productSvc.bulkAddProducts(i).subscribe({next:()=>alert("Manual products added"),error:e=>alert("Error: "+e.message)})}onFileSelected(i){let e=i.target.files?.[0];if(!e||!this.storeId)return;let a=new FileReader;a.onload=()=>{let s=a.result.split(/\r?\n/).filter(g=>g.trim()),re=s.shift().split(",").map(g=>g.trim());this.csvProducts=s.map(g=>{let ie=g.split(",").map(_=>_.trim()),v={};return re.forEach((_,oe)=>v[_]=ie[oe]||""),{storeId:this.storeId,productName:v.productName,category:v.category,description:v.description,price:parseFloat(v.price)||0,barcode:v.barcode,isActive:v.isActive?.toLowerCase()==="true"}})},a.readAsText(e)}onSubmitCsv(){this.csvProducts.length&&this.productSvc.bulkAddProducts(this.csvProducts).subscribe({next:()=>{alert("CSV products uploaded"),this.csvProducts=[]},error:i=>alert("CSV upload error: "+i.message)})}loadStore(i){this.storeSvc.getStore(i).subscribe(e=>this.store=e)}loadExisting(i){this.storeSvc.getStoreProducts(i).subscribe(e=>this.existingProducts=e)}static \u0275fac=function(e){return new(e||d)(b(W),b(w),b(k),b(Z),b(ee))};static \u0275cmp=F({type:d,selectors:[["app-add-products"]],decls:22,vars:6,consts:[[1,"container"],[1,"mb-4"],["for","storeSelect",1,"form-label"],["id","storeSelect",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mb-4",4,"ngIf"],["type","file","accept",".csv",1,"form-control",3,"change"],[3,"ngSubmit","formGroup"],["formArrayName","products"],["class","card mb-3",3,"formGroupName",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","mb-3"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary"],[3,"value"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"table","table-sm","table-striped","mb-3"],[1,"btn","btn-success",3,"click"],[1,"card","mb-3",3,"formGroupName"],[1,"card-header"],[1,"card-body"],[1,"mb-3"],[1,"form-label"],["type","text","readonly","",1,"form-control",3,"value"],["type","text","formControlName","productName","placeholder","Enter product name","required","",1,"form-control"],[1,"row","mb-3"],[1,"col"],["type","text","formControlName","category",1,"form-control"],["type","text","formControlName","description",1,"form-control"],["type","number","formControlName","price","placeholder","0.00","required","",1,"form-control"],["type","text","formControlName","barcode",1,"form-control"],[1,"form-check","form-switch","mb-3"],["type","checkbox","formControlName","isActive",1,"form-check-input",3,"id"],[1,"form-check-label",3,"for"],[1,"text-end"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,a){e&1&&(r(0,"div",0)(1,"div",1)(2,"label",2),o(3,"Choose Store:"),t(),r(4,"select",3),f("ngModelChange",function(s){return a.onStoreSelected(s)}),r(5,"option",4),o(6,"-- Select a store --"),t(),p(7,ne,2,2,"option",5),t()(),p(8,ae,16,2,"div",6),r(9,"div",1)(10,"h4"),o(11,"Import via CSV"),t(),r(12,"input",7),f("change",function(s){return a.onFileSelected(s)}),t()(),p(13,le,20,1,"div",6),r(14,"form",8),f("ngSubmit",function(){return a.onSubmit()}),r(15,"div",9),p(16,me,37,8,"div",10),t(),r(17,"div",11)(18,"button",12),f("click",function(){return a.addProductRow()}),o(19," + Add Another Product "),t(),r(20,"button",13),o(21," Submit Products "),t()()()()),e&2&&(n(4),c("ngModel",a.storeId),n(3),c("ngForOf",a.stores),n(),c("ngIf",a.storeId&&a.store),n(5),c("ngIf",a.csvProducts.length),n(),c("formGroup",a.productsForm),n(2),c("ngForOf",a.productsArray.controls))},dependencies:[O,N,T,V,X,j,J,K,M,q,D,z,G,R,Q,B,Y,$,U,L,H],encapsulation:2})};export{te as AddProductsComponent};
