import{a as L}from"./chunk-Y343E7P7.js";import{a as D}from"./chunk-D2BC6RJP.js";import"./chunk-KOQOYHGF.js";import{e as k,g as V}from"./chunk-XSF5E5F2.js";import{b as T,d as R,e as B,f as W,g as N,h as j,t as z,v as A}from"./chunk-JGTENAP2.js";import{Ab as b,Bb as d,Fc as O,Gb as I,Hb as S,Hc as F,Ib as U,Kb as c,Mb as P,Oa as w,Qb as _,Rb as v,Sb as x,Ta as a,Za as f,ba as u,ca as g,db as y,hb as h,ob as p,tb as r,ub as l,va as M,vb as m,wc as E,zb as C}from"./chunk-HPFW3AUF.js";import"./chunk-EQDQRRRY.js";var Q=["fileInput"];function H(s,i){if(s&1){let e=C();r(0,"div",9)(1,"p"),c(2),l(),r(3,"button",10),b("click",function(){u(e);let t=d(2);return g(t.clearSelectedFile())}),c(4,"Clear"),l()()}if(s&2){let e=d(2);a(2),P("Selected: ",e.selectedFile.name,""),a(),p("disabled",e.isUploading)}}function G(s,i){s&1&&(r(0,"div",11)(1,"p"),c(2,"Uploading image..."),l()())}function J(s,i){if(s&1){let e=C();r(0,"div",3)(1,"img",4),b("error",function(t){u(e);let o=d();return g(o.setDefaultImage(t))}),l(),m(2,"br"),r(3,"button",5),b("click",function(){u(e);let t=d();return g(t.triggerFileInput())}),c(4),l(),r(5,"input",6,0),b("change",function(t){u(e);let o=d();return g(o.onFileSelected(t))}),l(),h(7,H,5,2,"div",7)(8,G,3,0,"div",8),l()}if(s&2){let e=d();a(),p("src",e.previewImageUrl||e.getFullImageUrl(e.user.avatar)||"assets/images/avatar.png",w),a(2),p("disabled",e.isUploading),a(),P(" ",e.isUploading?"Uploading...":"Change Profile Picture"," "),a(),p("disabled",e.isUploading),a(2),p("ngIf",e.selectedFile),a(),p("ngIf",e.isUploading)}}function K(s,i){if(s&1){let e=C();r(0,"form",12),b("ngSubmit",function(){u(e);let t=d();return g(t.onSubmit())}),r(1,"label"),c(2," Name: "),r(3,"input",13),x("ngModelChange",function(t){u(e);let o=d();return v(o.user.name,t)||(o.user.name=t),g(t)}),l()(),m(4,"br"),r(5,"label"),c(6," Email: "),r(7,"input",14),x("ngModelChange",function(t){u(e);let o=d();return v(o.user.email,t)||(o.user.email=t),g(t)}),l()(),m(8,"br"),r(9,"label"),c(10," Phone: "),r(11,"input",15),x("ngModelChange",function(t){u(e);let o=d();return v(o.user.phone,t)||(o.user.phone=t),g(t)}),l()(),m(12,"br"),r(13,"label"),c(14," Address: "),r(15,"input",16),x("ngModelChange",function(t){u(e);let o=d();return v(o.user.address,t)||(o.user.address=t),g(t)}),l()(),m(16,"br"),r(17,"fieldset",17)(18,"label"),c(19," Referral/Coupon Code: "),m(20,"input",18),l(),m(21,"br"),r(22,"label"),c(23," Loyalty Points: "),m(24,"input",19),l(),m(25,"br"),r(26,"label"),c(27," Credits Available: "),m(28,"input",19),l(),m(29,"br"),l(),r(30,"button",20),c(31,"Save Changes"),l()()}if(s&2){let e=d();a(3),_("ngModel",e.user.name),a(4),_("ngModel",e.user.email),a(4),_("ngModel",e.user.phone),a(4),_("ngModel",e.user.address),a(5),p("value",e.user.couponCode||"N/A"),a(4),p("value",e.user.bonus_points||e.user.loyaltyPoints||0),a(4),p("value",e.user.creditsAvailable||0)}}var q=class s{constructor(i,e,n,t,o){this.platformId=i;this.route=e;this.userProfileService=n;this.router=t;this.imageUrlService=o}fileInput;user;selectedFile=null;previewImageUrl=null;isUploading=!1;ngOnInit(){if(F(this.platformId)){let i=this.route.snapshot.paramMap.get("id");i&&i!=="null"?this.userProfileService.getUserProfileById(i).subscribe({next:e=>{this.user=e},error:e=>{console.error("Error fetching user profile:",e),alert("Invalid user ID or profile not found"),this.router.navigate(["/"])}}):(alert("Invalid user ID"),this.router.navigate(["/"]))}}onFileSelected(i){let e=i.target;if(e.files&&e.files[0]){let n=e.files[0];if(!n.type.startsWith("image/")){alert("Please select a valid image file.");return}if(n.size>5*1024*1024){alert("File size must be less than 5MB.");return}this.selectedFile=n;let t=new FileReader;t.onload=o=>{this.previewImageUrl=o.target?.result},t.readAsDataURL(n)}}triggerFileInput(){this.fileInput.nativeElement.click()}clearSelectedFile(){this.selectedFile=null,this.previewImageUrl=null,this.fileInput&&(this.fileInput.nativeElement.value="")}getFullImageUrl(i){return this.imageUrlService.getFullImageUrl(i)}onSubmit(){this.user?.id?this.selectedFile?(this.isUploading=!0,this.userProfileService.uploadProfilePicture(this.user.id,this.selectedFile).subscribe({next:i=>{this.user.avatar=i,this.isUploading=!1,this.clearSelectedFile(),this.updateUserProfile()},error:i=>{console.error("File upload failed:",i),this.isUploading=!1,alert("Failed to upload profile picture. Please try again.")}})):this.updateUserProfile():alert("No user data available to update")}updateUserProfile(){this.userProfileService.updateUserProfile(this.user.id,this.user).subscribe({next:()=>{alert("Profile updated successfully!"),this.router.navigate(["/user-profile",this.user.id])},error:i=>{console.error("Error updating user profile:",i),alert("Failed to update profile. Please try again.")}})}setDefaultImage(i){let e=i.target;e.src="assets/images/avatar.png"}static \u0275fac=function(e){return new(e||s)(f(M),f(k),f(D),f(V),f(L))};static \u0275cmp=y({type:s,selectors:[["app-user-edit"]],viewQuery:function(e,n){if(e&1&&I(Q,5),e&2){let t;S(t=U())&&(n.fileInput=t.first)}},decls:2,vars:2,consts:[["fileInput",""],["class","profile-image-wrapper",4,"ngIf"],[3,"ngSubmit",4,"ngIf"],[1,"profile-image-wrapper"],["alt","Profile Picture","width","150","height","150",1,"profile-preview",3,"error","src"],["type","button",1,"change-picture-btn",3,"click","disabled"],["type","file","accept","image/*",2,"display","none",3,"change","disabled"],["class","file-info",4,"ngIf"],["class","upload-progress",4,"ngIf"],[1,"file-info"],["type","button",1,"clear-btn",3,"click","disabled"],[1,"upload-progress"],[3,"ngSubmit"],["type","text","name","name","required","",3,"ngModelChange","ngModel"],["type","email","name","email","required","",3,"ngModelChange","ngModel"],["type","text","name","phone",3,"ngModelChange","ngModel"],["type","text","name","address",3,"ngModelChange","ngModel"],["disabled",""],["type","text",3,"value"],["type","number",3,"value"],["type","submit"]],template:function(e,n){e&1&&h(0,J,9,6,"div",1)(1,K,32,7,"form",2),e&2&&(p("ngIf",n.user),a(),p("ngIf",n.user))},dependencies:[O,E,A,j,T,R,B,z,N,W],styles:["form[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;padding:1.5rem;background-color:#f9f9f9;border-radius:8px;box-shadow:0 2px 8px #0000001a}.profile-image-wrapper[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem;padding:1rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}.profile-image-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;object-fit:cover;border:2px solid #ddd}.profile-image-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:.5rem}form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:1rem;font-weight:500}form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.5rem;font-size:1rem;margin-top:.25rem;border:1px solid #0B3B5B;border-radius:4px}button[_ngcontent-%COMP%]{padding:.6rem 1.2rem;background-color:#0b3b5b;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem;margin-top:.5rem}button[disabled][_ngcontent-%COMP%]{background-color:#ccc;cursor:not-allowed}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem;padding:.6rem 1.2rem;background-color:#0b3b5b;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem}form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{background-color:#ccc;cursor:not-allowed}img[_ngcontent-%COMP%]{display:block;margin:1rem auto;border-radius:50%;object-fit:cover;border:2px solid #ddd}.profile-preview[_ngcontent-%COMP%]{border-radius:50%;object-fit:cover;border:3px solid #0B3B5B;transition:all .3s ease;box-shadow:0 2px 8px #007bff33}.profile-preview[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #007bff4d}.change-picture-btn[_ngcontent-%COMP%]{background-color:#0b3b5bcc;color:#fff;border:none;padding:.5rem 1rem;border-radius:6px;cursor:pointer;font-size:.9rem;margin-top:.5rem;transition:background-color .3s ease}.change-picture-btn[_ngcontent-%COMP%]:hover{background-color:#0b3b5b}.file-info[_ngcontent-%COMP%]{margin-top:1rem;padding:.5rem;background-color:#e7f3ff;border:1px solid #b3d7ff;border-radius:4px;font-size:.9rem}.file-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#333}.clear-btn[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:.3rem .6rem;border-radius:4px;cursor:pointer;font-size:.8rem;transition:background-color .3s ease}.clear-btn[_ngcontent-%COMP%]:hover{background-color:#c82333}.upload-progress[_ngcontent-%COMP%]{margin-top:1rem;padding:.5rem;background-color:#fff3cd;border:1px solid #ffeaa7;border-radius:4px;font-size:.9rem;color:#856404;text-align:center}.upload-progress[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}button[_ngcontent-%COMP%]:disabled{background-color:#ccc!important;cursor:not-allowed!important;opacity:.6}button[_ngcontent-%COMP%]:disabled:hover{background-color:#ccc!important}"]})};export{q as UserEditComponent};
